import{i as H,p as W,l as _}from"./index-DbUEaAMy.js";import"./react-Dp4Gqg7U.js";const K="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let y=(n=21)=>{let i="",t=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)i+=K[t[n]&63];return i};const L=6e4,F=36e5,P=Symbol.for("constructDateFrom");function x(n,i){return typeof n=="function"?n(i):n&&typeof n=="object"&&P in n?n[P](i):n instanceof Date?new n.constructor(i):new Date(i)}function w(n,i){return x(i||n,n)}function O(n,i,t){const e=w(n,t==null?void 0:t.in);return isNaN(i)?x(n,NaN):(i&&e.setDate(e.getDate()+i),e)}function A(n,i){const t=n<0?"-":"",e=Math.abs(n).toString().padStart(i,"0");return t+e}function q(n,i){const t=w(n,i==null?void 0:i.in);if(isNaN(+t))throw new RangeError("Invalid time value");const e=(i==null?void 0:i.format)??"extended";let a="";const r=e==="extended"?"-":"";{const s=A(t.getDate(),2),o=A(t.getMonth()+1,2);a=`${A(t.getFullYear(),4)}${r}${o}${r}${s}`}return a}function v(n,i){const t=()=>x(i==null?void 0:i.in,NaN),a=J(n);let r;if(a.date){const c=Q(a.date,2);r=X(c.restDateString,c.year)}if(!r||isNaN(+r))return t();const s=+r;let o=0,l;if(a.time&&(o=tt(a.time),isNaN(o)))return t();if(a.timezone){if(l=nt(a.timezone),isNaN(l))return t()}else{const c=new Date(s+o),d=w(0,i==null?void 0:i.in);return d.setFullYear(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),d.setHours(c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds()),d}return w(s+o+l,i==null?void 0:i.in)}const E={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Z=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,z=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,j=/^([+-])(\d{2})(?::?(\d{2}))?$/;function J(n){const i={},t=n.split(E.dateTimeDelimiter);let e;if(t.length>2)return i;if(/:/.test(t[0])?e=t[0]:(i.date=t[0],e=t[1],E.timeZoneDelimiter.test(i.date)&&(i.date=n.split(E.timeZoneDelimiter)[0],e=n.substr(i.date.length,n.length))),e){const a=E.timezone.exec(e);a?(i.time=e.replace(a[1],""),i.timezone=a[1]):i.time=e}return i}function Q(n,i){const t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+i)+"})|(\\d{2}|[+-]\\d{"+(2+i)+"})$)"),e=n.match(t);if(!e)return{year:NaN,restDateString:""};const a=e[1]?parseInt(e[1]):null,r=e[2]?parseInt(e[2]):null;return{year:r===null?a:r*100,restDateString:n.slice((e[1]||e[2]).length)}}function X(n,i){if(i===null)return new Date(NaN);const t=n.match(Z);if(!t)return new Date(NaN);const e=!!t[4],a=T(t[1]),r=T(t[2])-1,s=T(t[3]),o=T(t[4]),l=T(t[5])-1;if(e)return st(i,o,l)?et(i,o,l):new Date(NaN);{const c=new Date(0);return!it(i,r,s)||!rt(i,a)?new Date(NaN):(c.setUTCFullYear(i,r,Math.max(a,s)),c)}}function T(n){return n?parseInt(n):1}function tt(n){const i=n.match(z);if(!i)return NaN;const t=V(i[1]),e=V(i[2]),a=V(i[3]);return ot(t,e,a)?t*F+e*L+a*1e3:NaN}function V(n){return n&&parseFloat(n.replace(",","."))||0}function nt(n){if(n==="Z")return 0;const i=n.match(j);if(!i)return 0;const t=i[1]==="+"?-1:1,e=parseInt(i[2]),a=i[3]&&parseInt(i[3])||0;return lt(e,a)?t*(e*F+a*L):NaN}function et(n,i,t){const e=new Date(0);e.setUTCFullYear(n,0,4);const a=e.getUTCDay()||7,r=(i-1)*7+t+1-a;return e.setUTCDate(e.getUTCDate()+r),e}const at=[31,null,31,30,31,30,31,31,30,31,30,31];function B(n){return n%400===0||n%4===0&&n%100!==0}function it(n,i,t){return i>=0&&i<=11&&t>=1&&t<=(at[i]||(B(n)?29:28))}function rt(n,i){return i>=1&&i<=(B(n)?366:365)}function st(n,i,t){return i>=1&&i<=53&&t>=0&&t<=6}function ot(n,i,t){return n===24?i===0&&t===0:t>=0&&t<60&&i>=0&&i<60&&n>=0&&n<25}function lt(n,i){return i>=0&&i<=59}const ct={meta:{id:"hanoi-3n4d",city:"hanoi",title:"하노이+하롱베이 3박4일 정석",nights:3,defaultMode:"car",currency:"VND",plannedBudgetVnd:65e5,summary:"구시가지 시티투어에 유네스코 유산 하롱베이 크루즈까지 포함된 정석 코스"},base:{name:"Old Quarter 호텔",location:{lat:21.035,lng:105.85}},days:[{items:[{kind:"activity",name:"노이바이 공항 도착 · 시내 이동",location:{lat:21.217,lng:105.804},timeStartMin:660,timeEndMin:720,costVnd:35e4},{kind:"activity",name:"호텔 체크인",location:{lat:21.035,lng:105.85},timeStartMin:720,timeEndMin:780},{kind:"meal",name:"분짜 닥킴 (점심)",location:{lat:21.033,lng:105.849},timeStartMin:780,timeEndMin:870,costVnd:1e5},{kind:"spot",name:"호안끼엠 호수 & 응옥선 사당",location:{lat:21.0287,lng:105.8521},timeStartMin:900,timeEndMin:1020},{kind:"spot",name:"수상인형극 관람",location:{lat:21.03,lng:105.853},timeStartMin:1050,timeEndMin:1110,costVnd:2e5},{kind:"meal",name:"맥주거리 야식",location:{lat:21.035,lng:105.853},timeStartMin:1140,timeEndMin:1260,costVnd:15e4}]},{items:[{kind:"spot",name:"호찌민 묘소 & 바딘 광장",location:{lat:21.0367,lng:105.8347},timeStartMin:540,timeEndMin:660,note:"오전에 방문해야 입장 가능 (반바지 X)"},{kind:"spot",name:"일주사 (한기둥 사원)",location:{lat:21.035,lng:105.834},timeStartMin:660,timeEndMin:690},{kind:"spot",name:"문묘 (국자감)",location:{lat:21.0274,lng:105.8354},timeStartMin:810,timeEndMin:930,costVnd:3e4},{kind:"spot",name:"기찻길 마을 (Train Street) 카페",location:{lat:21.024,lng:105.842},timeStartMin:960,timeEndMin:1050,costVnd:5e4},{kind:"spot",name:"성 요셉 성당",location:{lat:21.0288,lng:105.848},timeStartMin:1080,timeEndMin:1140}]},{items:[{kind:"activity",name:"하롱베이 투어 픽업",location:{lat:21.035,lng:105.85},timeStartMin:480,timeEndMin:720,costVnd:12e5,note:"왕복 이동시간 포함 약 3~4시간 소요"},{kind:"spot",name:"하롱베이 크루즈 & 점심",location:{lat:20.906,lng:107.073},timeStartMin:720,timeEndMin:960,note:"승솟 동굴, 티톱섬 전망대 등"},{kind:"activity",name:"하노이 복귀",location:{lat:21.035,lng:105.85},timeStartMin:960,timeEndMin:1200}]},{items:[{kind:"spot",name:"롯데센터 하노이 전망대/마트",location:{lat:21.032,lng:105.812},timeStartMin:600,timeEndMin:780,note:"기념품 쇼핑하기 좋음"},{kind:"meal",name:"포 10 리꿕수 (쌀국수)",location:{lat:21.03,lng:105.849},timeStartMin:810,timeEndMin:870,costVnd:7e4},{kind:"activity",name:"공항 이동 & 출국",location:{lat:21.217,lng:105.804},timeStartMin:900,timeEndMin:960}]}]},dt={meta:{id:"phuquoc-3n4d",city:"phuquoc",title:"푸꾸옥 3박4일 샘플",nights:3,defaultMode:"car",currency:"VND",plannedBudgetVnd:9e6,summary:"북부 사파리·빈원더 + 남부 케이블카·섬투어까지 담은 3박4일 코스"},base:{name:"Duong Dong 호텔",location:{lat:10.222,lng:103.959}},days:[{label:"DAY 1 · 도착 & 듀엉동 야경",items:[{kind:"activity",name:"푸꾸옥 공항 도착 · 호텔 이동",location:{lat:10.227,lng:103.967},timeStartMin:660,timeEndMin:700,costVnd:2e5},{kind:"activity",name:"호텔 체크인 · 점심",location:{lat:10.222,lng:103.959},timeStartMin:700,timeEndMin:780,costVnd:15e4},{kind:"spot",name:"Duong Dong 타운 산책",location:{lat:10.2172,lng:103.9593},timeStartMin:900,timeEndMin:1020},{kind:"spot",name:"딘커우 사당 선셋",location:{lat:10.2223,lng:103.9576},timeStartMin:1020,timeEndMin:1110},{kind:"meal",name:"푸꾸옥 야시장 해산물",location:{lat:10.222,lng:103.958},timeStartMin:1140,timeEndMin:1290,costVnd:4e5}]},{label:"DAY 2 · 북부 사파리 & 빈원더",items:[{kind:"activity",name:"북부 리조트 존 이동",location:{lat:10.222,lng:103.959},timeStartMin:450,timeEndMin:510,costVnd:3e5},{kind:"spot",name:"Vinpearl Safari",location:{lat:10.3371,lng:103.8909},timeStartMin:540,timeEndMin:720,costVnd:65e4},{kind:"meal",name:"사파리/리조트 존 점심",location:{lat:10.335,lng:103.897},timeStartMin:720,timeEndMin:780,costVnd:2e5},{kind:"spot",name:"VinWonders 테마파크",location:{lat:10.323,lng:103.896},timeStartMin:780,timeEndMin:1080,costVnd:95e4},{kind:"spot",name:"Grand World 야경 & 쇼",location:{lat:10.36,lng:103.855},timeStartMin:1080,timeEndMin:1290,costVnd:3e5}]},{label:"DAY 3 · 남부 케이블카 & 섬투어",items:[{kind:"activity",name:"남부 안토이/선셋타운 이동",location:{lat:10.222,lng:103.959},timeStartMin:450,timeEndMin:510,costVnd:3e5},{kind:"spot",name:"Hon Thom 케이블카 탑승",location:{lat:10.0208,lng:104.0176},timeStartMin:540,timeEndMin:600},{kind:"spot",name:"Hon Thom Nature Park · 워터파크",location:{lat:9.99,lng:104.05},timeStartMin:600,timeEndMin:780,costVnd:75e4},{kind:"spot",name:"안토이 군도 스노클링(단체투어)",location:{lat:9.91,lng:104.01},timeStartMin:810,timeEndMin:990},{kind:"meal",name:"선셋타운/안토이 해산물 저녁",location:{lat:10.01,lng:104.03},timeStartMin:1080,timeEndMin:1230,costVnd:4e5},{kind:"activity",name:"Duong Dong 호텔 귀환",location:{lat:10.222,lng:103.959},timeStartMin:1230,timeEndMin:1320}]},{label:"DAY 4 · 카페 & 출국",items:[{kind:"spot",name:"카페·스파 / 여유로운 아침",location:{lat:10.222,lng:103.959},timeStartMin:540,timeEndMin:660,costVnd:15e4},{kind:"activity",name:"체크아웃 · 공항 이동",location:{lat:10.222,lng:103.959},timeStartMin:720,timeEndMin:810,costVnd:2e5},{kind:"activity",name:"푸꾸옥 공항 출발",location:{lat:10.227,lng:103.967},timeStartMin:900,timeEndMin:930}]}]},mt={meta:{id:"danang-3n4d",city:"danang",title:"다낭 3박4일 샘플",nights:3,defaultMode:"car",currency:"VND",plannedBudgetVnd:78e5,summary:"미케비치·용다리·바나힐·호이안까지 담은 3박4일 코스"},base:{name:"My Khe Beach 호텔",location:{lat:16.067,lng:108.246}},days:[{label:"DAY 1 · 도착 & 미케비치",items:[{kind:"activity",name:"다낭 공항 도착 · 호텔 이동",location:{lat:16.043,lng:108.199},timeStartMin:660,timeEndMin:720,costVnd:2e5},{kind:"activity",name:"호텔 체크인 · 점심",location:{lat:16.067,lng:108.246},timeStartMin:720,timeEndMin:810,costVnd:15e4},{kind:"spot",name:"미케 비치 수영 · 산책",location:{lat:16.0694,lng:108.2097},timeStartMin:900,timeEndMin:1020},{kind:"meal",name:"해산물 저녁 (미케 인근)",location:{lat:16.066,lng:108.235},timeStartMin:1080,timeEndMin:1170,costVnd:3e5},{kind:"spot",name:"용다리 · 한강 야경",location:{lat:16.074,lng:108.2139},timeStartMin:1200,timeEndMin:1290}]},{label:"DAY 2 · 바나힐 & 골든브리지",items:[{kind:"activity",name:"호텔 조식 · 바나힐 이동",location:{lat:16.067,lng:108.246},timeStartMin:450,timeEndMin:510,costVnd:35e4},{kind:"spot",name:"바나힐 케이블카 탑승",location:{lat:16.0262,lng:108.0329},timeStartMin:510,timeEndMin:540},{kind:"spot",name:"골든브리지 & 정원 산책",location:{lat:15.9949,lng:107.9963},timeStartMin:540,timeEndMin:660,openMin:420,closeMin:1260},{kind:"spot",name:"프렌치 빌리지 · 놀이기구",location:{lat:15.996,lng:107.997},timeStartMin:660,timeEndMin:900},{kind:"meal",name:"다낭 시내 귀환 · 한강변 저녁",location:{lat:16.0678,lng:108.2062},timeStartMin:1080,timeEndMin:1200,costVnd:25e4}]},{label:"DAY 3 · 마블마운틴 & 호이안",items:[{kind:"spot",name:"마블마운틴(오전 트래킹)",location:{lat:15.9755,lng:108.2609},timeStartMin:540,timeEndMin:660,openMin:420,closeMin:1050},{kind:"meal",name:"호이안 이동 · 점심",location:{lat:15.8797,lng:108.3319},timeStartMin:720,timeEndMin:780,costVnd:15e4},{kind:"spot",name:"호이안 구시가지 산책",location:{lat:15.8797,lng:108.3319},timeStartMin:780,timeEndMin:1020},{kind:"meal",name:"호이안 등불 야경 · 까오러우 저녁",location:{lat:15.8773,lng:108.3259},timeStartMin:1080,timeEndMin:1230,costVnd:22e4},{kind:"activity",name:"다낭 호텔 귀환",location:{lat:16.067,lng:108.246},timeStartMin:1230,timeEndMin:1320}]},{label:"DAY 4 · 카페 & 출국",items:[{kind:"spot",name:"카페·스파 / 자유시간",location:{lat:16.067,lng:108.246},timeStartMin:540,timeEndMin:660},{kind:"activity",name:"체크아웃 · 공항 이동",location:{lat:16.067,lng:108.246},timeStartMin:720,timeEndMin:780,costVnd:15e4},{kind:"activity",name:"다낭 공항 출발",location:{lat:16.043,lng:108.199},timeStartMin:840,timeEndMin:900}]}]},ut={meta:{id:"nhatrang-3n4d",city:"nhatrang",title:"나트랑 3박4일 액티비티 팩",nights:3,defaultMode:"car",currency:"VND",plannedBudgetVnd:75e5,summary:"빈원더스·머드온천·포나가르 사원까지, 휴양과 재미를 모두 잡은 코스"},base:{name:"나트랑 시내 호텔 (여행자거리)",location:{lat:12.238,lng:109.196}},days:[{label:"DAY 1 · 도착 & 야시장",items:[{kind:"activity",name:"깜란 공항 도착 · 시내 이동",location:{lat:11.998,lng:109.219},timeStartMin:780,timeEndMin:840,costVnd:35e4,note:"택시/픽업 차량으로 약 40분 소요"},{kind:"activity",name:"호텔 체크인 · 휴식",location:{lat:12.238,lng:109.196},timeStartMin:840,timeEndMin:960},{kind:"meal",name:"나트랑 야시장 해산물 저녁",location:{lat:12.239,lng:109.196},timeStartMin:1080,timeEndMin:1200,costVnd:4e5},{kind:"spot",name:"나트랑 비치 밤 산책",location:{lat:12.24,lng:109.197},timeStartMin:1200,timeEndMin:1260}]},{label:"DAY 2 · 빈원더스 올데이",items:[{kind:"activity",name:"빈펄섬 이동 (케이블카/스피드보트)",location:{lat:12.213,lng:109.22},timeStartMin:540,timeEndMin:600,costVnd:88e4},{kind:"spot",name:"빈원더스 나트랑 (놀이공원 & 워터파크)",location:{lat:12.218,lng:109.243},timeStartMin:600,timeEndMin:1020,note:"워터파크, 동물원, 알파인 코스터 즐기기"},{kind:"spot",name:"타타쇼 (Tata Show) 관람",location:{lat:12.218,lng:109.243},timeStartMin:1140,timeEndMin:1200},{kind:"activity",name:"시내 복귀",location:{lat:12.238,lng:109.196},timeStartMin:1230,timeEndMin:1290}]},{label:"DAY 3 · 시티 투어 & 머드 온천",items:[{kind:"spot",name:"포나가르 사원 (참파 유적)",location:{lat:12.265,lng:109.195},timeStartMin:540,timeEndMin:660,costVnd:3e4},{kind:"spot",name:"롱선사 (거대 좌불상)",location:{lat:12.251,lng:109.18},timeStartMin:690,timeEndMin:780},{kind:"meal",name:"현지식 반쎄오 점심",location:{lat:12.243,lng:109.193},timeStartMin:780,timeEndMin:870,costVnd:15e4},{kind:"spot",name:"아이리조트 머드 온천",location:{lat:12.29,lng:109.175},timeStartMin:930,timeEndMin:1110,costVnd:35e4,note:"여행의 피로 풀기, 수영복 지참"},{kind:"meal",name:"루프탑 바 & 칵테일",location:{lat:12.241,lng:109.196},timeStartMin:1200,timeEndMin:1320,costVnd:3e5}]},{label:"DAY 4 · 쇼핑 & 출국",items:[{kind:"spot",name:"담 시장 (Dam Market) 쇼핑",location:{lat:12.254,lng:109.191},timeStartMin:600,timeEndMin:720,note:"라탄백, 건망고 등 기념품"},{kind:"meal",name:"CCCP 커피 (코코넛 커피)",location:{lat:12.242,lng:109.193},timeStartMin:720,timeEndMin:810,costVnd:6e4},{kind:"activity",name:"호텔 체크아웃 · 공항 이동",location:{lat:12.238,lng:109.196},timeStartMin:840,timeEndMin:900},{kind:"activity",name:"깜란 공항 출발",location:{lat:11.998,lng:109.219},timeStartMin:960,timeEndMin:1020}]}]},gt={"hanoi-3n4d":ct,"phuquoc-3n4d":dt,"danang-3n4d":mt,"nhatrang-3n4d":ut},Mt={hanoi:"hanoi-3n4d",phuquoc:"phuquoc-3n4d",danang:"danang-3n4d",nhatrang:"nhatrang-3n4d",hcm:"danang-3n4d",Hanoi:"hanoi-3n4d","Phu Quoc":"phuquoc-3n4d","Da Nang":"danang-3n4d","Nha Trang":"nhatrang-3n4d"};function ft(n){return n.includes("-")?n:Mt[n]??n}function pt(n){const i=ft(n),t=gt[i];if(t)return t;throw new Error(`Template not statically available: ${i}`)}function yt(n,i,t){const e=n.filter(s=>typeof s.lat=="number"&&typeof s.lng=="number");if(e.length<2)return null;const a=[],r=[];for(let s=0;s<e.length-1;s++)a.push({lat:e[s].lat,lng:e[s].lng}),r.push({lat:e[s+1].lat,lng:e[s+1].lng});return{origins:a,destinations:r,mode:i,departureTime:t==null?void 0:t.departureTime,trafficModel:"best_guess",unitSystem:"METRIC"}}function St(n){var e,a;if(!n||n.length===0)return[];const i=Math.min(n.length,((e=n[0])==null?void 0:e.length)??0),t=[];for(let r=0;r<i;r++)t.push(((a=n[r])==null?void 0:a[r])??null);return t}const It=10*60*1e3,Y={DRIVING:13.9,WALKING:1.4,BICYCLING:4.5,TRANSIT:8.3},Dt=n=>Y[n]??Y.DRIVING;function ht(n,i){const e=d=>d*Math.PI/180,a=e(i.lat-n.lat),r=e(i.lng-n.lng),s=e(n.lat),o=e(i.lat),l=Math.sin(a/2)**2+Math.cos(s)*Math.cos(o)*Math.sin(r/2)**2;return 6371e3*(2*Math.asin(Math.sqrt(l)))}async function kt(n,i){var m,g,f,u,S,p,I;const t=(m=window.google)==null?void 0:m.maps;if(!(t!=null&&t.DistanceMatrixService))throw new Error("DistanceMatrixService not available");const e=new t.DistanceMatrixService,a=t.TravelMode[i.mode]||t.TravelMode.DRIVING,r=i.units==="imperial"?t.UnitSystem.IMPERIAL:t.UnitSystem.METRIC,s={origins:[n.origin],destinations:[n.destination],travelMode:a,unitSystem:r};i.mode==="DRIVING"&&i.departureTime&&(s.drivingOptions={departureTime:i.departureTime});const o=await new Promise((M,D)=>{e.getDistanceMatrix(s,(h,C)=>{if(C!=="OK")return D(new Error(C));M(h)})}),l=(u=(f=(g=o==null?void 0:o.rows)==null?void 0:g[0])==null?void 0:f.elements)==null?void 0:u[0];if(!l||l.status!=="OK")return{distanceMeters:0,durationSec:0,status:"ZERO_RESULTS",providerUsed:"google"};const c=((S=l.duration_in_traffic)==null?void 0:S.value)??((p=l.duration)==null?void 0:p.value)??0;return{distanceMeters:((I=l.distance)==null?void 0:I.value)??0,durationSec:c,status:"OK",providerUsed:"google"}}async function Tt(n,i){const t=ht(n.origin,n.destination),e=t/Dt(i);return{distanceMeters:Math.round(t),durationSec:Math.max(1,Math.round(e)),status:"OK",providerUsed:"fallback"}}async function Et(n,i,t){const e=new Array(n.length);let a=0;const r=new Array(Math.min(i,n.length)).fill(0).map(async()=>{for(;a<n.length;){const s=a++;e[s]=await t(n[s],s)}});return await Promise.all(r),e}const b=new Map,N=new Map;function wt(n,i,t){const e=`${n.origin.lat.toFixed(5)},${n.origin.lng.toFixed(5)}`,a=`${n.destination.lat.toFixed(5)},${n.destination.lng.toFixed(5)}`;return`${e}|${a}|${i}|${t}`}async function At(n,i={}){var d,m;const t=i.mode??"DRIVING",e=i.units??"metric",a=i.provider??"google",r=i.concurrency??5,s=i.ttlMs??It,o=!!((m=(d=window.google)==null?void 0:d.maps)!=null&&m.DistanceMatrixService),l=a==="google";return Et(n,r,async g=>{const f=wt(g,t,e),u=Date.now(),S=N.get(f);if(S&&u-S.at<s)return S.value;const p=b.get(f);if(p)return p;const I=(async()=>{try{if(l&&o){const D=await kt(g,{mode:t,units:e,departureTime:i.departureTime});return N.set(f,{at:Date.now(),value:D}),D}}catch{}const M=await Tt(g,t);return N.set(f,{at:Date.now(),value:M}),M})();b.set(f,I);try{return await I}finally{b.delete(f)}})}function G(){return{mode:null,loading:!1,error:null,metricsByKey:{}}}function xt(n){return n.currentTripId?n.trips[n.currentTripId]??null:null}function Vt(n,i){const t=i??n.currentTripId;if(!t)return[];const e=n.trips[t];return e?e.dayIds.map(a=>n.days[a]).filter(a=>!!a):[]}function bt(n,i){if(!i)return[];const t=n.days[i];return t?t.itemIds.map(e=>n.items[e]).filter(e=>!!e):[]}function vt(n,i){return[]}function k(n){const i=typeof n=="string"?v(n):n;return q(i,{})}function $(n){const i=Math.floor(n/60),t=n%60;return`${String(i).padStart(2,"0")}:${String(t).padStart(2,"0")}`}function R(n,i,t){const e=[],a={},r=v(i);for(let s=0;s<=t;s+=1){const o=y(),l=O(r,s),c=k(l);e.push(o),a[o]={id:o,tripId:n,dateISO:c,itemIds:[],order:s}}return{dayIds:e,days:a}}const U={trips:{},days:{},items:{},links:{},places:{},currentTripId:null,lastSampleTripId:null,distanceMatrix:G()},Ct=H()(W((n,i)=>({...U,createTrip:t=>{const e=y(),a=new Date().toISOString(),r=k(t.startDateISO),s=Math.max(1,t.nights),{dayIds:o,days:l}=R(e,r,s),c={id:e,title:t.title,startDateISO:r,nights:s,dayIds:o,createdAt:a,updatedAt:a,budgetTotal:t.budgetTotal??void 0,currency:t.currency||"VND",transportDefault:t.transportDefault||"car",baseHotelPlaceId:null,templateMeta:t.templateMeta??null,isSample:t.isSample??!1};let d={...i().places};if(t.baseHotel){const m=y();d[m]={id:m,name:t.baseHotel.name,lat:t.baseHotel.lat,lng:t.baseHotel.lng,address:t.baseHotel.address??"",createdAt:a,updatedAt:a,source:"user"},c.baseHotelPlaceId=m}return n(m=>({...m,trips:{...m.trips,[e]:c},days:{...m.days,...l},places:d,currentTripId:e})),e},setCurrentTripId:t=>{n(e=>({...e,currentTripId:t}))},setTripTitle:(t,e)=>{n(a=>{const r=a.trips[t];return r?{trips:{...a.trips,[t]:{...r,title:e,updatedAt:new Date().toISOString()}}}:{}})},setTripDates:(t,e,a)=>{n(r=>{const s=r.trips[t];if(!s)return{};const o=v(e),l=[...s.dayIds],c={...r.days};if(l.forEach((d,m)=>{if(c[d]){const g=O(o,m);c[d]={...c[d],dateISO:k(g),order:m}}}),a>s.nights)for(let d=s.nights+1;d<=a;d++){const m=y(),g=O(o,d);l.push(m),c[m]={id:m,tripId:t,dateISO:k(g),itemIds:[],order:d}}else if(a<s.nights){const d=s.nights-a;l.splice(l.length-d,d).forEach(g=>{delete c[g]})}return{trips:{...r.trips,[t]:{...s,startDateISO:e,nights:a,dayIds:l,updatedAt:new Date().toISOString()}},days:c}})},setTripBudget:(t,e)=>{n(a=>{const r=a.trips[t];return r?{trips:{...a.trips,[t]:{...r,budgetTotal:e??void 0,updatedAt:new Date().toISOString()}}}:{}})},setTripCurrency:(t,e)=>{n(a=>{const r=a.trips[t];return r?{trips:{...a.trips,[t]:{...r,currency:e,updatedAt:new Date().toISOString()}}}:{}})},setTripTransportDefault:(t,e)=>{n(a=>{const r=a.trips[t];return r?{trips:{...a.trips,[t]:{...r,transportDefault:e,updatedAt:new Date().toISOString()}}}:{}})},setTripBaseHotel:(t,e)=>{n(a=>{const r=a.trips[t];if(!r)return{};let s={...a.places},o=r.baseHotelPlaceId;return e?(o||(o=y()),s[o]={id:o,name:e.name,lat:e.lat,lng:e.lng,address:e.address??"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),source:"user"}):o&&(delete s[o],o=null),{trips:{...a.trips,[t]:{...r,baseHotelPlaceId:o,updatedAt:new Date().toISOString()}},places:s}})},addDay:(t,e)=>{const a=y();return n(r=>{const s=r.trips[t];return s?{trips:{...r.trips,[t]:{...s,nights:s.nights+1,dayIds:[...s.dayIds,a],updatedAt:new Date().toISOString()}},days:{...r.days,[a]:{id:a,tripId:t,dateISO:e,itemIds:[],order:s.dayIds.length}}}:{}}),a},removeDay:t=>{n(e=>{const a=e.days[t];if(!a)return{};const r=e.trips[a.tripId];if(!r)return{};const s=r.dayIds.filter(c=>c!==t),o={...e.days};delete o[t];const l={...e.items};return a.itemIds.forEach(c=>delete l[c]),{trips:{...e.trips,[r.id]:{...r,nights:Math.max(1,r.nights-1),dayIds:s,updatedAt:new Date().toISOString()}},days:o,items:l}})},addItem:t=>{const e=y();return n(a=>{const r=a.days[t.dayId];if(!r)return{};const s=new Date().toISOString();let o=t.placeId;const l={...a.places};!o&&t.googlePlace&&(o=y(),l[o]={id:o,name:t.googlePlace.name,lat:t.googlePlace.lat,lng:t.googlePlace.lng,address:t.googlePlace.address??"",googlePlaceId:t.googlePlace.placeId,source:"user",createdAt:s,updatedAt:s});const c={id:e,tripId:t.tripId,dayId:t.dayId,type:t.type??"activity",title:t.title??"새 일정",note:t.note??"",startTime:t.startTime??null,endTime:t.endTime??null,cost:t.cost??null,transportMode:t.transportMode??"car",placeId:o??null,order:r.itemIds.length,createdAt:s,updatedAt:s},d=[...r.itemIds];return typeof t.insertAfterIndex=="number"&&t.insertAfterIndex>=0&&t.insertAfterIndex<d.length?d.splice(t.insertAfterIndex+1,0,e):d.push(e),{items:{...a.items,[e]:c},days:{...a.days,[t.dayId]:{...r,itemIds:d}},places:l}}),e},updateItem:(t,e)=>{n(a=>{const r=a.items[t];return r?{items:{...a.items,[t]:{...r,...e,updatedAt:new Date().toISOString()}}}:{}})},removeItem:t=>{n(e=>{const a=e.items[t];if(!a)return{};const r=e.days[a.dayId],s={...e.items};delete s[t];const o={...e.days};r&&(o[r.id]={...r,itemIds:r.itemIds.filter(c=>c!==t)});const l={...e.links};return Object.values(e.links).forEach(c=>{(c.fromItemId===t||c.toItemId===t)&&delete l[c.id]}),{items:s,days:o,links:l}})},moveItemWithinDay:(t,e,a)=>{n(r=>{const s=r.days[t];if(!s)return{};const o=[...s.itemIds],[l]=o.splice(e,1);return o.splice(a,0,l),{days:{...r.days,[t]:{...s,itemIds:o}}}})},addLink:(t,e,a)=>{const r=y();return n(s=>{const o=s.items[t];return o?{links:{...s.links,[r]:{id:r,tripId:o.tripId,fromItemId:t,toItemId:e,mode:a}}}:{}}),r},updateLink:(t,e)=>{n(a=>{const r=a.links[t];return r?{links:{...a.links,[t]:{...r,...e}}}:{}})},removeLink:t=>{n(e=>{const a={...e.links};return delete a[t],{links:a}})},upsertPlace:t=>(n(e=>({places:{...e.places,[t.id]:t}})),t.id),removePlace:t=>{n(e=>{const a={...e.places};return delete a[t],{places:a}})},importSampleTrip:t=>{const e=t.templateId||"nhatrang-3n4d";let a;try{a=pt(e)}catch{return console.error("Template not found, creating empty trip"),i().createTrip({title:"새 여행",startDateISO:t.startDate||k(new Date),nights:3,isSample:!0})}const r=y(),s=new Date().toISOString(),o=t.startDate??k(new Date),l=a.meta.nights,{dayIds:c,days:d}=R(r,o,l),m={},g={};a.days.forEach((u,S)=>{const p=c[S];if(!p)return;const I=d[p];u.items.forEach(M=>{const D=y();let h=null;M.location&&(h=y(),g[h]={id:h,name:M.name,lat:M.location.lat,lng:M.location.lng,address:"",source:"template",createdAt:s,updatedAt:s}),m[D]={id:D,tripId:r,dayId:p,type:M.kind,title:M.name,note:M.note,startTime:M.timeStartMin?$(M.timeStartMin):null,endTime:M.timeEndMin?$(M.timeEndMin):null,cost:M.costVnd,transportMode:"car",placeId:h,order:I.itemIds.length,createdAt:s,updatedAt:s},I.itemIds.push(D)})});const f={id:r,title:a.meta.title,startDateISO:o,nights:l,dayIds:c,budgetTotal:a.meta.plannedBudgetVnd,currency:a.meta.currency,transportDefault:a.meta.defaultMode,baseHotelPlaceId:null,templateMeta:a.meta,isSample:!0,createdAt:s,updatedAt:s};if(a.base){const u=y();g[u]={id:u,name:a.base.name,lat:a.base.location.lat,lng:a.base.location.lng,address:a.base.address??"",source:"template",createdAt:s,updatedAt:s},f.baseHotelPlaceId=u}return n(u=>({...u,trips:{...u.trips,[r]:f},days:{...u.days,...d},items:{...u.items,...m},places:{...u.places,...g},currentTripId:r,lastSampleTripId:r})),r},setLastSampleTripId:t=>n({lastSampleTripId:t}),deleteTrip:t=>{n(e=>{const a={...e.trips};delete a[t];let r=e.currentTripId;return r===t&&(r=Object.keys(a)[0]||null),{trips:a,currentTripId:r}})},resetAllTrips:()=>n(U),requestDistanceMatrixForTrip:async(t,e)=>{const a=i();if(!a.trips[t])return;const s=Vt(a,t).flatMap(l=>bt(a,l.id)),o=yt({tripId:t,items:s,places:a.places,mode:e});if(!(!o||!o.pairs||o.pairs.length===0)){n(l=>({distanceMatrix:{...l.distanceMatrix,mode:e,loading:!0,error:null}}));try{const l=await At(o),c={...a.distanceMatrix.metricsByKey};(Array.isArray(l)?l:l.routes||[]).forEach(m=>{St(m.orderedItemIds).forEach(({from:f,to:u})=>{const S=`${t}:${f}:${u}`;let p="car";e==="WALKING"?p="walk":e==="TRANSIT"?p="transit":e==="BICYCLING"&&(p="bike"),c[S]={distanceMeters:m.distanceMeters,durationSeconds:m.durationSeconds,polyline:m.polyline,mode:p}})}),n(m=>({distanceMatrix:{...m.distanceMatrix,loading:!1,metricsByKey:c}}))}catch(l){n(c=>({distanceMatrix:{...c.distanceMatrix,loading:!1,error:l.message||"Distance check failed"}}))}}},clearDistanceMatrix:()=>{n({distanceMatrix:G()})}}),{name:"plan-store-v6",storage:_(()=>localStorage),partialize:n=>{const{distanceMatrix:i,...t}=n;return t}}));export{Vt as a,bt as b,vt as c,y as n,xt as s,Ct as u};
