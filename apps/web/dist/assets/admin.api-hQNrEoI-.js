import{w as d,o as w,q as S,l as f,c as r,g as p,m as l,d as i,r as _,n as R,p as U,u as h,j as C,t as c}from"./firebase-Co7q5P-C.js";import{s as E,d as a}from"./firebase-CmtxdFcx.js";const m=t=>t?typeof(t==null?void 0:t.toDate)=="function"?t.toDate().toISOString():typeof(t==null?void 0:t.seconds)=="number"?new Date(t.seconds*1e3).toISOString():typeof t=="string"?t:typeof t=="number"?new Date(t).toISOString():t instanceof Date?t.toISOString():new Date().toISOString():new Date().toISOString(),M=t=>t==="spot"||t==="review"||t==="comment"?t:"spot",O=t=>t==="pending"||t==="resolved"||t==="rejected"?t:"pending",y=t=>!t||typeof t!="object"?{}:t,j=async()=>{try{const t=await c(r(a,"users")),n=await c(r(a,"spots")),e=await c(r(a,"adult_spots")),s=await c(r(a,"events")),o=await c(r(a,"adult_events")),u=S(r(a,"spots"),d("isSponsored","==",!0)),g=await c(u);return{userCount:t.data().count,spotCount:n.data().count+e.data().count,eventCount:s.data().count+o.data().count,sponsorCount:g.data().count}}catch(t){return console.error("Dashboard stats error:",t),{userCount:0,spotCount:0,eventCount:0,sponsorCount:0}}},B=async t=>{const n=[];for(const e of t){const s=_(E,`spots/${Date.now()}_${e.name}`);await R(s,e);const o=await U(s);n.push(o)}return n},N=async t=>{const n=t.mode==="nightlife"?"adult_spots":"spots",e=[];t.region&&t.region!=="ALL"&&e.push(d("region","==",t.region)),t.category&&t.category!=="ALL"&&e.push(d("category","==",t.category)),t.isSponsored&&e.push(d("isSponsored","==",!0)),e.push(w("createdAt","desc"));const o=S(r(a,n),...e,f(500)),g=(await p(o)).docs.map(I=>({id:I.id,...y(I.data())})),b=t.page||1,A=t.limit||20,D=(b-1)*A,T=D+A;return{data:g.slice(D,T),total:g.length}},k=async(t,n)=>{await l(i(a,n==="nightlife"?"adult_spots":"spots",t))},F=async()=>{const t=new Date().toISOString().split("T")[0],n=S(r(a,"spots"),d("isSponsored","==",!0),d("sponsorExpiry",">=",t),w("sponsorExpiry","asc"),f(200));return(await p(n)).docs.map(s=>({id:s.id,...y(s.data())}))},L=(t,n,e)=>{const s=y(n),o=String(s.title??s.name??"Untitled");return{id:t,title:o,name:String(s.name??s.title??o),date:typeof s.date=="string"?s.date:m(s.date),location:String(s.address??s.location??"Unknown"),description:s.description?String(s.description):"",image:s.image?String(s.image):"",mode:e}},v=async()=>{const[t,n]=await Promise.all([p(r(a,"events")),p(r(a,"adult_events"))]),e=t.docs.map(o=>L(o.id,o.data(),"explorer")),s=n.docs.map(o=>L(o.id,o.data(),"nightlife"));return[...e,...s].sort((o,u)=>o.date>u.date?-1:o.date<u.date?1:0)},z=async t=>{try{await l(i(a,"events",t))}catch{await l(i(a,"adult_events",t))}},H=async()=>(await p(r(a,"users"))).docs.map(n=>{const e=n.data();return{id:n.id,uid:e.uid??n.id,email:e.email??null,displayName:e.displayName??null,photoURL:e.photoURL??null,nickname:e.nickname??void 0,role:e.role==="admin"?"admin":"user",status:e.status==="banned"?"banned":"active",isAgeVerified:!!e.isAgeVerified,createdAt:m(e.createdAt),lastLoginAt:e.lastLoginAt?m(e.lastLoginAt):void 0,adminMemo:e.adminMemo?String(e.adminMemo):void 0,...y(e)}}),P=async(t,n)=>{await h(i(a,"users",t),{role:n,updatedAt:C()})},V=async(t,n,e)=>{await h(i(a,"users",t),{status:n,adminMemo:e??"",updatedAt:C()})},X=async t=>{await l(i(a,"users",t))},$=async()=>{try{return(await p(S(r(a,"reports"),w("createdAt","desc"),f(500)))).docs.map(n=>{const e=n.data();return{id:n.id,targetType:M(e.targetType),targetId:String(e.targetId??""),reason:String(e.reason??""),description:e.description?String(e.description):void 0,status:O(e.status),createdAt:m(e.createdAt),reportedBy:String(e.reportedBy??""),targetContent:e.targetContent?{title:e.targetContent.title?String(e.targetContent.title):void 0,content:e.targetContent.content?String(e.targetContent.content):void 0,image:e.targetContent.image?String(e.targetContent.image):void 0}:void 0}})}catch(t){return console.error("getReports error:",t),[]}},Q=async(t,n)=>{await h(i(a,"reports",t),{status:n==="delete"?"resolved":"rejected",updatedAt:C()})},G=async()=>({status:"healthy",timestamp:new Date().toISOString(),uptime:12345,dbLatency:12,memory:{rss:100,heapTotal:200,heapUsed:150},recentErrors:[]}),J=async()=>(console.log("Cache purge requested"),!0);export{N as a,v as b,z as c,k as d,H as e,G as f,j as g,P as h,X as i,V as j,F as k,$ as l,Q as p,J as r,B as u};
