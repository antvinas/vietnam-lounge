import{j as e,am as U,aM as C,z as r}from"./index-DbUEaAMy.js";import{r as l}from"./react-Dp4Gqg7U.js";import{e as S,h as k,i as D,j as B}from"./admin.api-hQNrEoI-.js";import"./firebase-Co7q5P-C.js";import"./firebase-CmtxdFcx.js";const z=s=>{if(s==null)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="string"||typeof s=="number"){const n=new Date(s);return isNaN(n.getTime())?null:n}if(typeof s=="object"&&typeof s.seconds=="number"){const n=new Date(s.seconds*1e3);return isNaN(n.getTime())?null:n}return null},M=s=>{const n=z(s);return n?n.toLocaleDateString():"-"},F=()=>{const[s,n]=l.useState([]),[f,m]=l.useState(!0),[u,d]=l.useState(!1),[h,y]=l.useState(null),[o,p]=l.useState(""),j=async()=>{try{m(!0);const t=await S();n(t)}catch{r.error("유저 목록을 불러오지 못했습니다.")}finally{m(!1)}};l.useEffect(()=>{j()},[]);const b=async(t,a)=>{try{await k(t,a),n(c=>c.map(i=>i.id===t?{...i,role:a}:i)),r.success("권한이 변경되었습니다.")}catch{r.error("권한 변경 실패")}},N=(t,a)=>{a==="banned"?(y(t),p(""),d(!0)):g(t,"active")},g=async(t,a,c)=>{try{await B(t,a,c),n(i=>i.map(x=>x.id===t?{...x,status:a}:x)),r.success(a==="banned"?"유저가 차단되었습니다.":"유저가 활성화되었습니다."),d(!1)}catch{r.error("상태 변경 실패")}},v=()=>{if(h){if(!o.trim()){r.error("차단 사유를 입력해주세요.");return}g(h,"banned",o)}},w=async t=>{if(window.confirm("정말 삭제하시겠습니까?"))try{await D(t),n(a=>a.filter(c=>c.id!==t)),r.success("유저가 삭제되었습니다.")}catch{r.error("삭제 실패")}};return f?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"로딩 중..."}):e.jsxs("div",{className:"p-8 max-w-7xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-gray-800",children:"회원 관리"}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 text-sm uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 font-semibold",children:"닉네임 / 이메일"}),e.jsx("th",{className:"px-6 py-4 font-semibold",children:"가입일"}),e.jsx("th",{className:"px-6 py-4 font-semibold",children:"권한"}),e.jsx("th",{className:"px-6 py-4 font-semibold",children:"상태"}),e.jsx("th",{className:"px-6 py-4 font-semibold text-center",children:"관리"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:s.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.nickname||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-500",children:t.email})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:M(t.createdAt)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("select",{value:t.role,onChange:a=>b(t.id,a.target.value),className:"bg-gray-100 text-gray-700 text-sm rounded px-2 py-1 outline-none",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("select",{value:t.status||"active",onChange:a=>N(t.id,a.target.value),className:`px-2 py-1 rounded text-sm font-bold outline-none cursor-pointer
                          ${t.status==="banned"?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}
                        `,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"banned",children:"Banned"})]})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("button",{onClick:()=>w(t.id),className:"text-gray-400 hover:text-red-600 p-2",children:e.jsx(U,{})})})]},t.id))})]})})}),u&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-2 flex items-center gap-2",children:[e.jsx(C,{className:"text-red-500"})," 유저 차단"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"차단 사유를 입력해주세요."}),e.jsx("textarea",{className:"w-full h-32 p-3 border border-gray-300 rounded focus:ring-2 focus:ring-red-500 outline-none text-sm resize-none",placeholder:"예: 지속적인 욕설",value:o,onChange:t=>p(t.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{onClick:()=>d(!1),className:"px-4 py-2 rounded text-gray-600 hover:bg-gray-100 text-sm",children:"취소"}),e.jsx("button",{onClick:v,className:"px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700 text-sm",children:"차단 확정"})]})]})})]})};export{F as default};
