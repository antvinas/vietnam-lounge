import{e as oe,j as e,f as Q,g as Y,z as O,n as ie,h as de,O as ce}from"./index-DbUEaAMy.js";import{r as w,a as ue}from"./react-Dp4Gqg7U.js";import{u as S,s as re,a as G,b as se,c as me}from"./plan.store-BbBRFP49.js";import{u as $,t as ne}from"./strings-CHsM0M4y.js";import{c as z,M as pe}from"./map-pin-6Og0nRkm.js";import{u as xe}from"./useFocusTrap-BFFwDj3m.js";import{u as ge}from"./useQuery-BhrWanxj.js";import{u as fe}from"./useMutation-C76_koY-.js";import"./firebase-Co7q5P-C.js";import"./firebase-CmtxdFcx.js";function he(){const[t,a]=oe(),{currentTripId:s,currentTrip:l,daysOfCurrentTrip:d,hasTrip:m}=S(n=>{const v=re(n),y=v?G(n,v.id):[],r=!!v;return{currentTripId:v?v.id:n.currentTripId??null,currentTrip:v,daysOfCurrentTrip:y,hasTrip:r}}),c=$(n=>n.currentDayId),i=$(n=>n.setCurrentDayId);return w.useEffect(()=>{var x;const n=t.get("dayId")||null;if(!m||!s){if(c&&i(null),n){const p=new URLSearchParams(t);p.delete("dayId"),a(p,{replace:!0})}return}const v=new Set(d.map(p=>p.id)),y=((x=d[0])==null?void 0:x.id)??null;if(d.length===0){if(c&&i(null),n){const p=new URLSearchParams(t);p.delete("dayId"),a(p,{replace:!0})}return}if(!c){let p=null;if(n&&v.has(n)?p=n:p=y,!p)return;if(i(p),n!==p){const h=new URLSearchParams(t);h.set("dayId",p),a(h,{replace:!0})}return}const r=v.has(c)?c:y;if(!r){if(c&&i(null),n){const p=new URLSearchParams(t);p.delete("dayId"),a(p,{replace:!0})}return}if(r!==c&&i(r),n!==r){const p=new URLSearchParams(t);p.set("dayId",r),a(p,{replace:!0})}},[m,s,d,c,t,i,a]),{hasTrip:m,currentTripId:s,currentTrip:l,currentDayId:c,daysOfCurrentTrip:d,setCurrentDayId:i}}function Z({dayId:t}){const a=S(r=>r.activeTripId),s=S(r=>r.activeDayId),l=S(r=>r.setActiveDayId);w.useEffect(()=>{t&&t!==s&&(l==null||l(t))},[t,s,l]);const d=S(r=>r.trips??{}),m=S(r=>r.days??{}),c=S(r=>r.items??{}),i=a?d[a]:null,n=w.useMemo(()=>((i==null?void 0:i.dayIds)??[]).map(x=>m[x]).filter(Boolean),[i,m]),v=w.useMemo(()=>s&&m[s]?m[s]:n[0]??null,[s,m,n]),y=w.useMemo(()=>((v==null?void 0:v.itemIds)??[]).map(x=>c[x]).filter(Boolean),[v,c]);return e.jsxs("aside",{className:"w-full md:w-80 border-r border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Days"}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:n.map((r,x)=>e.jsx("button",{type:"button",onClick:()=>l==null?void 0:l(r==null?void 0:r.id),className:["px-3 py-1.5 rounded-lg text-sm border",(r==null?void 0:r.id)===(v==null?void 0:v.id)?"bg-emerald-600 text-white border-emerald-600":"bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 border-gray-300 dark:border-gray-700"].join(" "),children:(r==null?void 0:r.label)??`Day ${x+1}`},(r==null?void 0:r.id)??x))})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Items"}),e.jsxs("div",{className:"mt-3 space-y-2",children:[y.map((r,x)=>e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-3 bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:(r==null?void 0:r.title)??(r==null?void 0:r.name)??`Item ${x+1}`}),((r==null?void 0:r.timeStartMin)!=null||(r==null?void 0:r.timeEndMin)!=null)&&e.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[(r==null?void 0:r.timeStartMin)??"--"," ~ ",(r==null?void 0:r.timeEndMin)??"--"]})]},(r==null?void 0:r.id)??x)),y.length===0&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ë“±ë¡ëœ ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤."})]})]})]})}function X(t,a){if(Object.is(t,a))return!0;if(typeof t!="object"||t===null||typeof a!="object"||a===null)return!1;if(t instanceof Map&&a instanceof Map){if(t.size!==a.size)return!1;for(const[l,d]of t)if(!Object.is(d,a.get(l)))return!1;return!0}if(t instanceof Set&&a instanceof Set){if(t.size!==a.size)return!1;for(const l of t)if(!a.has(l))return!1;return!0}const s=Object.keys(t);if(s.length!==Object.keys(a).length)return!1;for(const l of s)if(!Object.prototype.hasOwnProperty.call(a,l)||!Object.is(t[l],a[l]))return!1;return!0}function be(t){const a=`${t.origin.lat},${t.origin.lng}`,s=`${t.destination.lat},${t.destination.lng}`,l=new URLSearchParams;if(l.set("api","1"),l.set("origin",a),l.set("destination",s),t.waypoints&&t.waypoints.length){const d=t.waypoints.map(m=>`${m.lat},${m.lng}`).join("|");l.set("waypoints",d)}return t.travelMode&&l.set("travelmode",t.travelMode),`https://www.google.com/maps/dir/?${l.toString()}`}function ye(t,a){const l=x=>x*Math.PI/180,d=l(a.lat-t.lat),m=l(a.lng-t.lng),c=l(t.lat),i=l(a.lat),n=Math.sin(d/2),v=Math.sin(m/2),y=n*n+Math.cos(c)*Math.cos(i)*v*v;return 6371*(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)))}function ve(t){const a=S(d=>d.places),s=S(d=>d.items),l=S(d=>d.days);return w.useMemo(()=>{if(!t)return{points:[],distanceKmTotal:0,durationSecTotal:0};const d=l==null?void 0:l[t],m=Array.isArray(d==null?void 0:d.itemIds)?d.itemIds:[];let c=[];if(m.length)c=m.map(r=>s==null?void 0:s[r]).filter(Boolean);else{c=Object.values(s??{}).filter(x=>x.dayId===t).filter(x=>!!x.placeId||typeof x.lat=="number"&&typeof x.lng=="number");const r=x=>x.order??x.sortIndex??(typeof x.timeStartMin=="number"?x.timeStartMin:Number.MAX_SAFE_INTEGER);c=c.slice().sort((x,p)=>r(x)-r(p))}const i=[];for(const r of c)if(r.placeId){const x=a==null?void 0:a[r.placeId];x&&typeof x.lat=="number"&&typeof x.lng=="number"&&i.push({lat:x.lat,lng:x.lng})}else typeof r.lat=="number"&&typeof r.lng=="number"&&i.push({lat:r.lat,lng:r.lng});let n=0;for(let r=1;r<i.length;r++)n+=ye(i[r-1],i[r]);const y=n>0?Math.round(n/25*3600):0;return{points:i,distanceKmTotal:n,durationSecTotal:y}},[t,s,a,l])}function ke(){var C;const t=S(re),a=S(b=>G(b,t==null?void 0:t.id))||[],s=$(b=>b.currentDayId)??((C=a[0])==null?void 0:C.id)??null,{currency:l,budgetTotal:d,budgetSpent:m,budgetLeft:c}=S(b=>{var j,I;const f=(t==null?void 0:t.id)??b.currentTripId??"",u=Object.values(b.items).filter(M=>M.tripId===f).reduce((M,D)=>M+(D.cost??0),0),g=((j=b.trips[f])==null?void 0:j.budgetTotal)??0;return{currency:((I=b.trips[f])==null?void 0:I.currency)??"VND",budgetTotal:g,budgetSpent:u,budgetLeft:Math.max(0,g-u)}},X),i=d>0?Math.min(100,m/d*100):0,n=d>0&&m>d,{conflictCount:v,dayPoints:y}=S(b=>{if(!s)return{conflictCount:0,dayPoints:[]};const f=se(b,s),u=me(),g=b.places||{},j=f.map(I=>{if(!I.placeId)return null;const M=g[I.placeId];return!M||typeof M.lat!="number"||typeof M.lng!="number"?null:{lat:M.lat,lng:M.lng}}).filter(I=>!!I);return{conflictCount:u.length,dayPoints:j}},X),{durationSecTotal:r}=ve(s),x=typeof r=="number"&&r>0?Math.round(r/60):0,p=!!t&&!!s&&y.length>=2,h=()=>{if(!t||!s||y.length<2)return;const b=y[0],f=y[y.length-1],u=y.length>2?y.slice(1,-1):void 0,g=be({origin:b,destination:f,waypoints:u,travelMode:"driving"});window.open(g,"_blank","noopener,noreferrer")},T=S(b=>b.currentTripId),o=S(b=>b.deleteTrip),N=$(b=>b.reset),k=()=>{T&&window.confirm("í˜„ì¬ ì—¬í–‰ ì¼ì •ì„ ëª¨ë‘ ì‚­ì œí•˜ê³  ë©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°ˆê¹Œìš”?")&&(o(T),N())};return t?e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-slate-200 bg-slate-50 px-3 py-1.5 shadow-sm dark:border-slate-700 dark:bg-slate-800",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-white text-lg shadow-sm dark:bg-slate-700",children:"ğŸ’°"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-baseline gap-1.5",children:[e.jsx("span",{className:"text-[10px] font-medium text-slate-500 dark:text-slate-400",children:"ë‚¨ì€ ì˜ˆì‚°"}),e.jsx("span",{className:`text-sm font-bold ${n?"text-rose-500":"text-emerald-600 dark:text-emerald-400"}`,children:c.toLocaleString()}),e.jsx("span",{className:"text-[10px] text-slate-400",children:l})]}),e.jsx("div",{className:"relative mt-0.5 h-1 w-24 overflow-hidden rounded-full bg-slate-200 dark:bg-slate-600",children:e.jsx("div",{className:`absolute left-0 top-0 h-full transition-all duration-500 ${n?"bg-rose-500":"bg-emerald-500"}`,style:{width:`${i}%`}})})]}),e.jsxs("div",{className:"hidden flex-col border-l border-slate-200 pl-3 text-[10px] text-slate-400 dark:border-slate-700 sm:flex",children:[e.jsxs("span",{children:["ì´ ",d.toLocaleString()]}),e.jsxs("span",{children:["ì“´ëˆ ",m.toLocaleString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s&&x>0&&e.jsxs("div",{className:"hidden items-center gap-1 rounded-full bg-slate-100 px-2.5 py-1 text-xs font-medium text-slate-600 dark:bg-slate-800 dark:text-slate-300 sm:flex",children:[e.jsx("span",{children:"ğŸš—"}),e.jsxs("span",{children:[x,"ë¶„ ì´ë™"]})]}),v>0&&e.jsx("div",{className:"flex items-center gap-1 rounded-full bg-rose-50 px-2.5 py-1 text-xs font-medium text-rose-600 dark:bg-rose-900/30 dark:text-rose-300",children:e.jsxs("span",{children:["âš ï¸ ê²¹ì¹¨ ",v]})}),e.jsx("div",{className:"h-4 w-px bg-slate-200 dark:bg-slate-700"}),p&&e.jsx("button",{type:"button",onClick:h,className:"rounded-md border border-slate-200 bg-white px-2.5 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50 hover:text-blue-600 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",children:"ğŸ—º ì§€ë„ ë³´ê¸°"}),T&&e.jsx("button",{type:"button",onClick:k,className:"rounded-md border border-slate-200 bg-white px-2.5 py-1.5 text-xs font-medium text-slate-700 hover:bg-rose-50 hover:text-rose-600 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",children:"ğŸ—‘ ì‚­ì œ"})]})]}):null}const we=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]}];function J(){const t=Q(),a=Y(),{currentDayId:s,hoverSpotId:l,selectedItemId:d,setSelectedItemId:m,setEditingItemId:c,setMap:i,isItemDetailOpen:n}=$(f=>({currentDayId:f.currentDayId,hoverSpotId:f.hoverSpotId,selectedItemId:f.selectedItemId,setSelectedItemId:f.setSelectedItemId,setEditingItemId:f.setEditingItemId,setMap:f.setMap,isItemDetailOpen:f.isItemDetailOpen})),{rawItems:v,places:y}=S(f=>({rawItems:s?se(f,s)??[]:[],places:f.places??{}})),r=w.useMemo(()=>{if(!s)return[];const f=[];return v.forEach(u=>{const g=u.placeId,j=g?y[g]:void 0,I=j&&j.lat&&j.lng?{lat:j.lat,lng:j.lng}:null,M=u.lat&&u.lng?{lat:u.lat,lng:u.lng}:null,D=u.googlePlace,E=D&&D.lat&&D.lng?{lat:D.lat,lng:D.lng}:null,L=I??M??E;L&&f.push({id:u.id,lat:L.lat,lng:L.lng,category:u.category})}),f},[v,y,s]),x=w.useMemo(()=>r.map(f=>({lat:f.lat,lng:f.lng})),[r]),p=w.useRef(null),h=w.useRef(null),T=w.useRef(new Map),o=w.useRef(null),N=w.useRef(!1),k=w.useRef(null),C=w.useRef(0);w.useEffect(()=>{if(!p.current)return;let f=0;const u=setInterval(()=>{if(f++,window.google&&p.current&&(clearInterval(u),!h.current)){const g=new google.maps.Map(p.current,{center:{lat:16.047,lng:108.206},zoom:13,disableDefaultUI:!0,zoomControl:!0,backgroundColor:"#e5e7eb"});h.current=g,i(g);const j=()=>{N.current=!0};g.addListener("dragend",j),g.addListener("zoom_changed",j)}f>=50&&clearInterval(u)},200);return()=>{clearInterval(u),i(null)}},[i]),w.useEffect(()=>{if(!h.current||typeof document>"u")return;const f=h.current,u=()=>{const j=document.documentElement.classList.contains("dark");f.setOptions({styles:j?we:[],backgroundColor:j?"#242f3e":"#e5e7eb"})};u();const g=new MutationObserver(j=>{j.forEach(I=>{I.type==="attributes"&&I.attributeName==="class"&&u()})});return g.observe(document.documentElement,{attributes:!0}),()=>g.disconnect()},[]),w.useEffect(()=>{s!==k.current&&(N.current=!1,C.current=0,k.current=s??null)},[s]),w.useEffect(()=>{const f=h.current;if(!f)return;T.current.forEach(g=>g.marker.setMap(null)),T.current.clear(),o.current&&(o.current.setMap(null),o.current=null),x.length>1&&(o.current=new google.maps.Polyline({path:x,map:f,strokeColor:"#22c55e",strokeOpacity:.8,strokeWeight:4})),r.forEach((g,j)=>{const I=(g.category||"").toLowerCase(),D=["karaoke","club","bar","pub","lounge","nightlife"].some(L=>I.includes(L))?"#d946ef":"#22c55e",E=new google.maps.Marker({position:{lat:g.lat,lng:g.lng},map:f,label:{text:`${j+1}`,color:"white",fontWeight:"bold"},icon:{path:google.maps.SymbolPath.CIRCLE,scale:9,fillColor:D,fillOpacity:1,strokeWeight:2,strokeColor:"#ffffff"}});E.addListener("click",()=>{m(g.id),c(g.id),N.current=!0,f.panTo({lat:g.lat,lng:g.lng}),(f.getZoom()||0)<15&&f.setZoom(15)}),T.current.set(g.id,{id:g.id,marker:E,baseColor:D})});const u=C.current;if(r.length>0&&(!N.current||r.length!==u)){const g=new google.maps.LatLngBounds;r.forEach(I=>g.extend({lat:I.lat,lng:I.lng}));const j=n?380:50;f.fitBounds(g,{top:50,bottom:50,left:50,right:j})}C.current=r.length},[r,x,s,m,c,n]),w.useEffect(()=>{const f=h.current;f&&T.current.forEach((u,g)=>{const j=l&&g===l||d&&g===d,{marker:I,baseColor:M}=u;if(I.setIcon(j?{path:google.maps.SymbolPath.CIRCLE,scale:12,fillColor:M,fillOpacity:1,strokeWeight:3,strokeColor:"#ffffff"}:{path:google.maps.SymbolPath.CIRCLE,scale:9,fillColor:M,fillOpacity:1,strokeWeight:2,strokeColor:"#ffffff"}),I.setZIndex(j?999:1),j&&d===g){const D=I.getPosition();D&&(f.panTo(D),n&&f.panBy(150,0))}})},[l,d,n]);const b=()=>{if(!s){O("ì¼ì°¨ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.");return}t(`/plan/search?dayId=${s}`,{state:{backgroundLocation:a,background:a}})};return e.jsxs("div",{className:"relative h-full w-full",children:[e.jsx("div",{ref:p,className:"h-full w-full bg-slate-200 dark:bg-slate-800"}),r.length===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:"pointer-events-auto bg-white/90 dark:bg-gray-900/90 p-4 rounded-xl shadow-lg text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300 mb-2",children:"ë“±ë¡ëœ ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤."}),e.jsx("button",{onClick:b,className:"px-4 py-2 bg-emerald-500 text-white rounded-lg text-xs font-bold hover:bg-emerald-600",children:"ì¥ì†Œ ê²€ìƒ‰í•˜ê¸°"})]})})]})}const Ne={small:"35vh",medium:"65vh",large:"85vh"};function le({open:t,onClose:a,title:s,initialSnap:l="medium",footer:d,children:m,portalId:c="portal-root"}){const i=w.useRef(null),n=w.useRef(null);if(w.useEffect(()=>{if(!t)return;n.current=document.activeElement;const r=p=>{if(p.key==="Escape"&&a(),p.key==="Tab"){const h=i.current;if(!h)return;const T=h.querySelectorAll('a,button,input,select,textarea,[tabindex]:not([tabindex="-1"])');if(!T.length)return;const o=T[0],N=T[T.length-1];p.shiftKey&&document.activeElement===o?(N.focus(),p.preventDefault()):!p.shiftKey&&document.activeElement===N&&(o.focus(),p.preventDefault())}},x=p=>{const h=p.target,T=document.getElementById("mobile-sheet-backdrop");h===T&&a()};return document.addEventListener("keydown",r),document.addEventListener("click",x),setTimeout(()=>{var h;const p=((h=i.current)==null?void 0:h.querySelector("[data-autofocus]"))??i.current;p==null||p.focus()},0),()=>{var p,h;document.removeEventListener("keydown",r),document.removeEventListener("click",x),(h=(p=n.current)==null?void 0:p.focus)==null||h.call(p)}},[t,a]),!t)return null;const v=e.jsxs("div",{role:"dialog","aria-modal":"true","aria-label":s??"Panel",className:"fixed inset-0 z-[60] lg:hidden",children:[e.jsx("div",{id:"mobile-sheet-backdrop",className:"absolute inset-0 bg-black/40","aria-hidden":"true"}),e.jsxs("div",{ref:i,tabIndex:-1,className:"absolute inset-x-0 bottom-0 rounded-t-2xl bg-white shadow-2xl ring-1 ring-black/10 outline-none dark:bg-gray-900 dark:ring-white/10",style:{height:Ne[l]},children:[e.jsx("div",{className:"flex items-center justify-center py-2",children:e.jsx("span",{"aria-hidden":"true",className:"h-1.5 w-10 rounded-full bg-gray-300 dark:bg-gray-700"})}),s&&e.jsx("div",{className:"px-4 pb-2 text-base font-semibold",children:s}),e.jsx("div",{className:"h-full overflow-y-auto px-2 pb-24",children:m}),d&&e.jsx("div",{className:"pointer-events-auto absolute inset-x-0 bottom-0 border-t bg-white/90 p-3 backdrop-blur dark:border-gray-800 dark:bg-gray-900/90",children:d})]})]}),y=document.getElementById(c);return y?ue.createPortal(v,y):v}/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Ie=z("arrow-right",je);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Se=z("compass",Te);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],Me=z("list",Ce);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],$e=z("map",De);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Le=z("plus",Ee);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Oe=z("save",Pe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],_e=z("trash-2",Re),ze=[{id:"danang-3n4d",city:"ë‹¤ë‚­",title:"3ë°• 4ì¼ íë§ & ìœ í¥ ì™„ì „ì •ë³µ",desc:"ë¯¸ì¼€ë¹„ì¹˜, ë°”ë‚˜í, ê·¸ë¦¬ê³  ëœ¨ê±°ìš´ ë°¤ë¬¸í™”ê¹Œì§€.",img:"https://images.unsplash.com/photo-1559592413-7cec4d0cae2b?auto=format&fit=crop&w=600&q=80"},{id:"nhatrang-3n4d",city:"ë‚˜íŠ¸ë‘",title:"ë¹ˆì›ë”ìŠ¤ & ë¨¸ë“œì˜¨ì²œ ì•¡í‹°ë¹„í‹°",desc:"ë‚®ì—ëŠ” ì‹ ë‚˜ëŠ” í…Œë§ˆíŒŒí¬, ë°¤ì—ëŠ” ë£¨í”„íƒ‘ ë°”.",img:"https://images.unsplash.com/photo-1540202404-a2f29016b523?auto=format&fit=crop&w=600&q=80"},{id:"phuquoc-3n4d",city:"í‘¸ê¾¸ì˜¥",title:"ë‚¨ë¶€/ë¶ë¶€ í•µì‹¬ ìŠ¤íŒŸ ì´ì •ë¦¬",desc:"ì‚¬íŒŒë¦¬ë¶€í„° ì¼€ì´ë¸”ì¹´ê¹Œì§€, íœ´ì–‘ì˜ ëíŒì™•.",img:"https://images.unsplash.com/photo-1590609749472-4045414912a2?auto=format&fit=crop&w=600&q=80"}];function Ue({locale:t="ko",hasExistingTrip:a,onCreateNew:s,onOpenSample:l,onOpenSampleTrip:d,onImportSample:m,onOpenExisting:c}){const i=l||d;return e.jsxs("div",{className:"relative flex h-full w-full flex-col overflow-hidden bg-slate-900 text-white shadow-2xl",children:[e.jsxs("div",{className:"absolute inset-0 z-0 pointer-events-none",children:[e.jsx("img",{src:"https://images.unsplash.com/photo-1552465011-b4e21bf6e79a?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80",alt:"Vietnam Day",className:"h-full w-full object-cover opacity-100 transition-opacity duration-700 dark:opacity-0"}),e.jsx("img",{src:"https://images.unsplash.com/photo-1583417319070-4a69db38a482?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80",alt:"Vietnam Night",className:"absolute inset-0 h-full w-full object-cover opacity-0 transition-opacity duration-700 dark:opacity-100"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/60 to-transparent"})]}),e.jsxs("div",{className:"relative z-10 flex flex-1 flex-col items-center justify-center px-6 text-center",children:[e.jsxs("div",{className:"mb-6 inline-flex items-center rounded-full border border-white/20 bg-white/10 px-3 py-1 text-xs font-medium text-emerald-300 backdrop-blur-md",children:[e.jsx(Se,{className:"mr-1.5 h-3.5 w-3.5"}),"ë² íŠ¸ë‚¨ ì—¬í–‰ í”Œë˜ë„ˆ"]}),e.jsxs("h1",{className:"mb-4 max-w-3xl text-3xl font-bold leading-tight tracking-tight sm:text-5xl drop-shadow-lg",children:["ë‹¹ì‹ ì˜ ì™„ë²½í•œ ë² íŠ¸ë‚¨ ì—¬í–‰,",e.jsx("br",{}),e.jsx("span",{className:"text-emerald-400",children:"ì§€ê¸ˆ ì‹œì‘í•´ë³¼ê¹Œìš”?"})]}),e.jsx("p",{className:"mb-10 max-w-lg text-base text-slate-200 sm:text-lg drop-shadow-md",children:ne(t,"empty","subtitle")}),e.jsxs("div",{className:"flex w-full max-w-md flex-col gap-3 sm:flex-row",children:[e.jsx("button",{onClick:i,className:"flex flex-1 items-center justify-center whitespace-nowrap rounded-xl bg-emerald-500 px-6 py-3.5 text-base font-bold text-white shadow-lg shadow-emerald-500/25 transition hover:bg-emerald-400 active:scale-95",children:"ì¶”ì²œ ì½”ìŠ¤ë¡œ ì‹œì‘í•˜ê¸°"}),a&&e.jsx("button",{onClick:c,className:"flex flex-1 items-center justify-center whitespace-nowrap rounded-xl border border-white/20 bg-white/5 px-6 py-3.5 text-base font-semibold text-white backdrop-blur-sm transition hover:bg-white/10 active:scale-95",children:"ì´ì „ ì¼ì • ì—´ê¸°"})]}),!a&&e.jsx("button",{onClick:s,className:"mt-6 text-sm font-medium text-slate-300 underline decoration-slate-500 underline-offset-4 hover:text-white",children:"ë¹ˆ í™”ë©´ì—ì„œ ì§ì ‘ ë§Œë“¤ë˜ìš”"})]}),e.jsx("div",{className:"relative z-10 w-full border-t border-white/10 bg-black/20 backdrop-blur-md",children:e.jsxs("div",{className:"mx-auto max-w-5xl px-6 py-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-200",children:"ğŸ”¥ ì§€ê¸ˆ ëœ¨ëŠ” ì¶”ì²œ ì½”ìŠ¤"}),e.jsxs("button",{onClick:i,className:"flex items-center text-xs font-medium text-emerald-400 hover:text-emerald-300",children:["ì „ì²´ ë³´ê¸° ",e.jsx(Ie,{className:"ml-1 h-3 w-3"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:ze.map(n=>e.jsxs("button",{onClick:()=>m(n.id),className:"group relative flex h-24 w-full overflow-hidden rounded-xl border border-white/10 bg-slate-800 text-left transition hover:border-emerald-500/50 hover:shadow-xl sm:h-32",children:[e.jsx("div",{className:"w-24 shrink-0 sm:w-32",children:e.jsx("img",{src:n.img,alt:n.city,className:"h-full w-full object-cover transition duration-500 group-hover:scale-110",onError:v=>{v.currentTarget.src="https://via.placeholder.com/150?text=Vietnam"}})}),e.jsxs("div",{className:"flex flex-1 flex-col justify-center px-4",children:[e.jsxs("div",{className:"mb-1 flex items-center text-[10px] font-bold uppercase tracking-wider text-emerald-400",children:[e.jsx(pe,{className:"mr-1 h-3 w-3"})," ",n.city]}),e.jsx("div",{className:"mb-1 text-sm font-bold text-white line-clamp-1",children:n.title}),e.jsx("div",{className:"text-xs text-slate-400 line-clamp-1 sm:line-clamp-2",children:n.desc})]})]},n.id))})]})})]})}const Ae=({open:t,onClose:a})=>{const{currentTripId:s,trip:l}=S(k=>{const C=k.currentTripId;return{currentTripId:C,trip:C?k.trips[C]:null}}),[d,m]=w.useState(""),[c,i]=w.useState(""),[n,v]=w.useState(1),[y,r]=w.useState(1),[x,p]=w.useState("VND"),[h,T]=w.useState(0);if(w.useEffect(()=>{!t||!l||(m(l.title??""),i(l.startDateISO??""),v(l.nights??1),r(l.travelerCount??1),p(l.currency??"VND"),T(l.budgetTotal??0))},[t,l]),!t||!s||!l)return null;const o=k=>{k.target===k.currentTarget&&a()},N=()=>{if(!s||!l)return;const k=Math.max(1,n),C=Math.max(1,y),b=Math.max(0,h),f=(d??"").trim()||l.title||"",u=c||l.startDateISO,g=x||l.currency,{setTripTitle:j,setTripDates:I,setTripCurrency:M,setTripBudget:D}=S.getState();j(s,f),I(s,u,k),M(s,g),D(s,b),S.setState(E=>{const L=E.trips[s];return L?{...E,trips:{...E.trips,[s]:{...L,travelerCount:C}}}:E}),a()};return e.jsx("div",{className:"fixed inset-0 z-30 flex items-start justify-center bg-black/50 px-4 pt-20",onClick:o,children:e.jsxs("div",{className:"w-full max-w-lg max-h-[85vh] overflow-y-auto bg-white rounded-2xl p-6 shadow-lg dark:bg-gray-900",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-50",children:"ì—¬í–‰ ì •ë³´ ìˆ˜ì •"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"ì¶œë°œì¼, ìˆ™ë°• ìˆ˜, ì¸ì›, ì˜ˆì‚° ë“±ì„ ì„¤ì •í•´ ì£¼ì„¸ìš”."})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200",children:"ì—¬í–‰ ì´ë¦„"}),e.jsx("input",{type:"text",value:d,onChange:k=>m(k.target.value),className:"w-full rounded-md border border-gray-300 bg-white py-2 px-3 text-sm text-gray-900 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-50",placeholder:"ì˜ˆ: í•˜ë…¸ì´ 2ë°• 3ì¼ ì—¬í–‰"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200",children:"ì¶œë°œì¼"}),e.jsx("input",{type:"date",value:c,onChange:k=>i(k.target.value),className:"w-full rounded-md border border-gray-300 bg-white py-2 px-3 text-sm text-gray-900 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-50"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200",children:"ìˆ™ë°• ìˆ˜"}),e.jsx("input",{type:"number",min:1,value:n,onChange:k=>v(Math.max(1,Number(k.target.value)||1)),className:"w-full rounded-md border border-gray-300 bg-white py-2 px-3 text-sm text-gray-900 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-50"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200",children:"ì¸ì›"}),e.jsx("input",{type:"number",min:1,value:y,onChange:k=>r(Math.max(1,Number(k.target.value)||1)),className:"w-full rounded-md border border-gray-300 bg-white py-2 px-3 text-sm text-gray-900 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-50"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200",children:"í†µí™”"}),e.jsxs("select",{value:x,onChange:k=>p(k.target.value),className:"w-full rounded-md border border-gray-300 bg-white py-2 px-3 text-sm text-gray-900 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-50",children:[e.jsx("option",{value:"VND",children:"VND"}),e.jsx("option",{value:"KRW",children:"KRW"}),e.jsx("option",{value:"USD",children:"USD"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200",children:"ì´ ì˜ˆì‚°"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:0,value:h,onChange:k=>T(Math.max(0,Number(k.target.value)||0)),className:"w-full rounded-md border border-gray-300 bg-white py-2 px-3 text-sm text-gray-900 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-50"}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:x})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:a,className:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:text-gray-200 dark:hover:bg-gray-800",children:"ì·¨ì†Œ"}),e.jsx("button",{type:"button",onClick:N,className:"rounded-md bg-emerald-500 px-4 py-2 text-sm font-medium text-white hover:bg-emerald-600",children:"ì €ì¥"})]})]})})};function Fe(t){const a=t.getFullYear(),s=`${t.getMonth()+1}`.padStart(2,"0"),l=`${t.getDate()}`.padStart(2,"0");return`${a}-${s}-${l}`}function Ve(t,a){const s=new Date(t);return Number.isNaN(s.getTime())?null:(s.setDate(s.getDate()+a),Fe(s))}function Ke(){const t=S(b=>b.currentTripId),a=S(b=>b.currentTripId?b.trips[b.currentTripId]:void 0),s=S(b=>b.duplicateTripAsUser),l=$(b=>b.currentDayId),[d,m]=w.useState(!1),[c,i]=w.useState(!1),n=S(b=>{const f=b.currentTripId;if(!f)return{currency:"VND",totalBudget:0,plannedCost:0,budgetLeft:0};const u=b.trips[f]||{},g=u.currency||"VND",j=u.budgetTotal||0,I=Object.values(b.items).filter(D=>D.tripId===f).reduce((D,E)=>D+(E.cost??0),0),M=Math.max(0,j-I);return{currency:g,totalBudget:j,plannedCost:I,budgetLeft:M}}),v=S(b=>t?G(b,t):[]),y=w.useMemo(()=>{if(!a)return"";const b=a.startDateISO,f=typeof a.nights=="number"?a.nights:2,u=f+1,g=b!=null?Ve(b,f):null;return b?g?`${f}ë°• ${u}ì¼ Â· ${b} ~ ${g}`:`${f}ë°• ${u}ì¼ Â· ${b}`:`${f}ë°• ${u}ì¼`},[a]),r=w.useMemo(()=>{if(!a||!l||!v.length)return null;const b=v.length,f=v.findIndex(u=>u.id===l);return f===-1?null:`ì´ ${b}ì¼ ì¤‘ ${f+1}ì¼ì°¨`},[a,l,v]);if(!t||!a)return null;const x=a.title||"ì œëª© ì—†ëŠ” ì—¬í–‰",p=!!a.isSample,h=typeof a.travelerCount=="number"&&a.travelerCount>0?a.travelerCount:1,T=h===1?"1ëª…":`${h.toLocaleString()}ëª…`,o=n.totalBudget.toLocaleString(),N=n.plannedCost.toLocaleString(),k=n.budgetLeft.toLocaleString(),C=async()=>{if(!(!t||!p||c))try{i(!0),await s(t),O.success("ìƒ˜í”Œ ì¼ì •ì„ ë‚´ ì¼ì •ìœ¼ë¡œ ë³µì‚¬í–ˆì–´ìš”.")}catch{O.error("ì¼ì • ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.")}finally{i(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"flex w-full flex-col gap-1 pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("h1",{className:"flex items-center gap-2 truncate text-base font-semibold text-gray-900 dark:text-gray-50",children:[e.jsx("span",{className:"truncate",children:x}),p&&e.jsx("span",{className:"shrink-0 rounded-full bg-amber-50 px-2 py-0.5 text-[11px] font-medium text-amber-700 dark:bg-amber-500/10 dark:text-amber-200",children:"ìƒ˜í”Œ ì¼ì •"})]}),e.jsxs("p",{className:"mt-0.5 text-xs text-gray-500 dark:text-gray-400",children:[y," Â· ",T]}),r&&e.jsx("p",{className:"mt-0.5 text-[11px] text-gray-400 dark:text-gray-500",children:r})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>m(!0),className:"rounded-md border border-gray-300 bg-white px-2 py-1 text-xs text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-200 dark:hover:bg-gray-800",children:"âœï¸ ì—¬í–‰ ì •ë³´ ìˆ˜ì •"}),p&&e.jsx("button",{type:"button",onClick:C,disabled:c,className:"rounded-md bg-emerald-500 px-2.5 py-1 text-xs font-medium text-white shadow-sm hover:bg-emerald-600 disabled:cursor-not-allowed disabled:opacity-60",children:c?"ë³µì‚¬ ì¤‘...":"ë‚´ ì¼ì •ìœ¼ë¡œ ë³µì‚¬í•˜ê¸°"})]})]}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-xs text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md bg-gray-100 px-2 py-0.5 dark:bg-gray-800",children:[e.jsx("span",{className:"font-medium",children:"ì´ ì˜ˆì‚°"}),e.jsxs("span",{className:"tabular-nums",children:[o," ",n.currency]})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md bg-gray-100 px-2 py-0.5 dark:bg-gray-800",children:[e.jsx("span",{className:"font-medium",children:"ì˜ˆìƒ ì§€ì¶œ"}),e.jsxs("span",{className:"tabular-nums",children:[N," ",n.currency]})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md bg-emerald-50 px-2 py-0.5 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-100",children:[e.jsx("span",{className:"font-medium",children:"ë‚¨ì€ ì˜ˆì‚°"}),e.jsxs("span",{className:"tabular-nums",children:[k," ",n.currency]})]})]})]}),e.jsx(Ae,{open:d,onClose:()=>m(!1)})]})}let R=null,_=null,K=!1;function Be(){R||(R=document.createElement("div"),R.setAttribute("role","status"),R.setAttribute("aria-atomic","true"),ee(R),document.body.appendChild(R)),_||(_=document.createElement("div"),_.setAttribute("role","alert"),_.setAttribute("aria-atomic","true"),ee(_),document.body.appendChild(_))}function ee(t){t.style.position="fixed",t.style.width="1px",t.style.height="1px",t.style.padding="0",t.style.overflow="hidden",t.style.clip="rect(0 0 0 0)",t.style.clipPath="inset(50%)",t.style.border="0",t.style.whiteSpace="nowrap",t.style.bottom="0",t.style.right="0",t.style.zIndex="-1"}function qe(t,a){t.textContent=`${K?"â€‹":""}${a}${K?"":"â€‹"}`,K=!K}function We(t,a="polite"){Be();const s=a==="assertive"?_:R;setTimeout(()=>qe(s,t),10)}const He=Array.from({length:48},(t,a)=>{const s=Math.floor(a/2),l=a%2===0?"00":"30";return`${s.toString().padStart(2,"0")}:${l}`});function te(t){return t.toString().padStart(2,"0")}function B(t){if(t==null||Number.isNaN(t))return"";const a=Math.floor(t/60),s=Math.max(0,Math.round(t-a*60));return`${te(a)}:${te(s)}`}function q(t){if(!t)return;const[a,s]=t.split(":").map(l=>parseInt(l,10));if(!(Number.isNaN(a)||Number.isNaN(s)))return a*60+s}function Qe(){var T;const t=w.useRef(null),a=$(o=>o.selectedItemId),s=$(o=>o.isItemDetailOpen),l=$(o=>o.setSelectedItemId),d=$(o=>o.closeItemDetail),m=w.useCallback(()=>{d(),l(null)},[d,l]);xe(t,!!a&&s);const{item:c,updateItem:i}=S(o=>{var k;return a?{item:(k=o.items)==null?void 0:k[a],updateItem:o.updateItem}:{item:null,updateItem:(C,b)=>{}}}),[n,v]=w.useState(null);w.useEffect(()=>{v(c?{id:c.id,title:c.title,note:c.note,cost:c.cost,startTime:B(c.timeStartMin),endTime:B(c.timeEndMin),stayMinutes:c.stayMinutes,placeId:c.placeId,lat:c.lat,lng:c.lng}:null)},[c]);const y=w.useMemo(()=>{if(!n)return"";if(n.startTime&&n.stayMinutes!=null){const N=(q(n.startTime)??0)+n.stayMinutes;return B(N>=1440?1439:N)}return n.endTime||""},[n==null?void 0:n.startTime,n==null?void 0:n.endTime,n==null?void 0:n.stayMinutes]);if(!s||!c||!n)return null;const r=(o,N)=>{v(k=>k&&{...k,[o]:N})},x=o=>{v(N=>{if(!N)return null;const k=N.stayMinutes??0;return{...N,stayMinutes:k+o}})},p=()=>{if(!n)return;const o={title:n.title,note:n.note,cost:n.cost,timeStartMin:q(n.startTime),timeEndMin:q(y||n.endTime),stayMinutes:n.stayMinutes};i(n.id,o),We("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."),m()},h=o=>{o.key==="Escape"&&(o.stopPropagation(),m())};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }
        input[type=number] {
          -moz-appearance: textfield;
        }
      `}),e.jsxs("aside",{ref:t,className:"absolute inset-y-2 right-2 z-30 flex w-[min(100%,26rem)] flex-col rounded-2xl border border-slate-200 bg-white/95 shadow-2xl backdrop-blur dark:border-slate-700 dark:bg-slate-900/95",role:"dialog","aria-modal":"true",onKeyDown:h,children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-slate-100 px-5 py-3 dark:border-slate-700",children:[e.jsx("h2",{className:"text-base font-bold text-slate-800 dark:text-slate-100",children:"ì¼ì • ìƒì„¸"}),e.jsx("button",{className:"rounded-full p-1 text-slate-400 hover:bg-slate-100 hover:text-slate-600 dark:hover:bg-slate-800",onClick:m,children:e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsxs("div",{className:"flex-1 space-y-4 overflow-y-auto px-5 py-4 scrollbar-hide",children:[e.jsxs("div",{className:"grid grid-cols-[80px_1fr] items-center gap-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400",children:"ì¥ì†Œëª…"}),e.jsx("input",{className:"w-full rounded-md border border-slate-300 bg-white px-3 py-1.5 text-sm font-medium text-slate-900 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100",value:n.title??"",onChange:o=>r("title",o.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-[80px_1fr] items-center gap-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400",children:"ë°©ë¬¸ ì‹œê°„"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative flex-1",children:e.jsxs("select",{className:"w-full appearance-none rounded-md border border-slate-300 bg-white px-2 py-1.5 text-sm text-slate-700 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-200",value:n.startTime||"",onChange:o=>r("startTime",o.target.value),children:[e.jsx("option",{value:"",children:"ë¯¸ì •"}),He.map(o=>e.jsx("option",{value:o,children:o},o))]})}),e.jsx("span",{className:"text-slate-400",children:"~"}),e.jsx("input",{className:"flex-1 rounded-md border border-slate-200 bg-slate-50 px-2 py-1.5 text-center text-sm text-slate-500 dark:border-slate-700 dark:bg-slate-800/50 dark:text-slate-400",value:y,readOnly:!0,placeholder:"ìë™"})]})]}),e.jsxs("div",{className:"grid grid-cols-[80px_1fr] items-center gap-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400",children:"ì²´ë¥˜ ì‹œê°„"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative w-24",children:[e.jsx("input",{className:"w-full rounded-md border border-slate-300 bg-white px-3 py-1.5 pr-8 text-right text-sm font-medium text-slate-900 placeholder-slate-400 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 dark:border-slate-600",type:"number",min:0,step:10,value:n.stayMinutes??0,onChange:o=>r("stayMinutes",Number(o.target.value))}),e.jsx("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-xs text-slate-400",children:"ë¶„"})]}),e.jsx("button",{type:"button",onClick:()=>x(30),className:"rounded border border-slate-200 bg-white px-2 py-1.5 text-xs font-medium text-slate-700 hover:border-emerald-300 hover:text-emerald-600 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-300",children:"+30ë¶„"}),e.jsx("button",{type:"button",onClick:()=>x(60),className:"rounded border border-slate-200 bg-white px-2 py-1.5 text-xs font-medium text-slate-700 hover:border-emerald-300 hover:text-emerald-600 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-300",children:"+1ì‹œê°„"})]})]}),e.jsx("hr",{className:"my-2 border-slate-100 dark:border-slate-700"}),e.jsxs("div",{className:"grid grid-cols-[80px_1fr] items-center gap-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400",children:"ë¹„ìš© (VND)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"w-full rounded-md border border-slate-300 bg-white px-3 py-1.5 pl-6 text-right text-sm font-medium tabular-nums text-slate-900 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100",type:"text",value:((T=n.cost)==null?void 0:T.toLocaleString())??"",onChange:o=>{const N=o.target.value.replace(/,/g,"");/^\d*$/.test(N)&&r("cost",N===""?0:Number(N))},placeholder:"0"}),e.jsx("span",{className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-sm text-slate-400",children:"â‚«"})]})]}),e.jsxs("div",{className:"grid grid-cols-[80px_1fr] items-start gap-3",children:[e.jsx("label",{className:"mt-2 text-xs font-semibold text-slate-500 dark:text-slate-400",children:"ë©”ëª¨"}),e.jsx("textarea",{className:"w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm leading-relaxed text-slate-900 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100",rows:3,value:n.note??"",onChange:o=>r("note",o.target.value),placeholder:"ë©”ë‰´, ì˜ˆì•½ë²ˆí˜¸ ë“±..."})]})]}),e.jsxs("div",{className:"flex shrink-0 gap-2 border-t border-slate-100 bg-slate-50 p-4 dark:border-slate-700 dark:bg-slate-800/50",children:[e.jsx("button",{onClick:m,className:"flex-1 rounded-xl border border-slate-300 bg-white py-2.5 text-sm font-semibold text-slate-700 hover:bg-slate-50 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-200 dark:hover:bg-slate-700",children:"ì·¨ì†Œ"}),e.jsx("button",{onClick:p,className:"flex-1 rounded-xl bg-emerald-500 py-2.5 text-sm font-bold text-white shadow-sm hover:bg-emerald-600 active:scale-95",children:"ì €ì¥í•˜ê¸°"})]})]})]})}const Ye=Array.from({length:48},(t,a)=>{const s=Math.floor(a/2),l=a%2===0?"00":"30";return`${s.toString().padStart(2,"0")}:${l}`});function ae(t){return t.toString().padStart(2,"0")}function W(t){if(t==null||Number.isNaN(t))return"";const a=Math.floor(t/60),s=Math.max(0,Math.round(t-a*60));return`${ae(a)}:${ae(s)}`}function H(t){if(!t)return;const[a,s]=t.split(":").map(l=>parseInt(l,10));if(!(Number.isNaN(a)||Number.isNaN(s)))return a*60+s}function Ge(){var T;const{selectedItemId:t,isItemDetailOpen:a,setSelectedItemId:s,closeItemDetail:l,setEditingItemId:d}=$(o=>o),{item:m,updateItem:c}=S(o=>{var k;return t?{item:(k=o.items)==null?void 0:k[t],updateItem:o.updateItem}:{item:null,updateItem:(C,b)=>{}}}),[i,n]=w.useState(null);w.useEffect(()=>{n(m?{id:m.id,title:m.title,note:m.note,cost:m.cost,startTime:W(m.timeStartMin),endTime:W(m.timeEndMin),stayMinutes:m.stayMinutes,placeId:m.placeId,lat:m.lat,lng:m.lng}:null)},[m]);const v=w.useMemo(()=>{if(!i)return"";if(i.startTime&&i.stayMinutes!=null){const N=(H(i.startTime)??0)+i.stayMinutes;return W(N>=1440?1439:N)}return i.endTime||""},[i==null?void 0:i.startTime,i==null?void 0:i.endTime,i==null?void 0:i.stayMinutes]),y=()=>{l(),s(null),d(null)},r=(o,N)=>{n(k=>k&&{...k,[o]:N})},x=o=>{n(N=>{if(!N)return null;const k=N.stayMinutes??0;return{...N,stayMinutes:k+o}})},p=()=>{if(!i)return;const o={title:i.title,note:i.note,cost:i.cost,timeStartMin:H(i.startTime),timeEndMin:H(v||i.endTime),stayMinutes:i.stayMinutes};c(i.id,o),ie.success("ì¼ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."),y()};if(!a||!i)return null;const h=e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsx("button",{onClick:y,className:"flex-1 rounded-xl border border-slate-300 bg-white py-3 text-sm font-semibold text-slate-700 active:bg-slate-50 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-200",children:"ì·¨ì†Œ"}),e.jsx("button",{onClick:p,className:"flex-1 rounded-xl bg-emerald-500 py-3 text-sm font-bold text-white shadow-sm active:bg-emerald-600",children:"ì €ì¥í•˜ê¸°"})]});return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }
        input[type=number] {
          -moz-appearance: textfield;
        }
      `}),e.jsx(le,{open:a,onClose:y,title:"ì¼ì • ìƒì„¸ í¸ì§‘",initialSnap:"large",footer:h,children:e.jsxs("div",{className:"flex flex-col gap-4 p-4 pb-6",children:[e.jsxs("div",{className:"grid grid-cols-[80px_1fr] items-center gap-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400",children:"ì¥ì†Œëª…"}),e.jsx("input",{className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm font-medium text-slate-900 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100",value:i.title??"",onChange:o=>r("title",o.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-[80px_1fr] items-center gap-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400",children:"ë°©ë¬¸ ì‹œê°„"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("select",{className:"w-full appearance-none rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-200",value:i.startTime||"",onChange:o=>r("startTime",o.target.value),children:[e.jsx("option",{value:"",children:"ë¯¸ì •"}),Ye.map(o=>e.jsx("option",{value:o,children:o},o))]}),e.jsx("div",{className:"pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-slate-400",children:"â–¼"})]}),e.jsx("span",{className:"text-slate-400",children:"~"}),e.jsx("input",{className:"flex-1 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-center text-sm text-slate-500 dark:border-slate-700 dark:bg-slate-800/50 dark:text-slate-400",value:v,readOnly:!0,placeholder:"ìë™"})]})]}),e.jsxs("div",{className:"grid grid-cols-[80px_1fr] items-center gap-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400",children:"ì²´ë¥˜ ì‹œê°„"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative w-24 shrink-0",children:[e.jsx("input",{className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 pr-8 text-right text-sm font-medium text-slate-900 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100",type:"number",min:0,step:10,value:i.stayMinutes??0,onChange:o=>r("stayMinutes",Number(o.target.value))}),e.jsx("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-xs text-slate-400",children:"ë¶„"})]}),e.jsxs("div",{className:"flex flex-1 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>x(30),className:"flex-1 rounded-lg border border-slate-200 bg-white py-2 text-xs font-medium text-slate-700 active:bg-slate-50 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-300",children:"+30ë¶„"}),e.jsx("button",{type:"button",onClick:()=>x(60),className:"flex-1 rounded-lg border border-slate-200 bg-white py-2 text-xs font-medium text-slate-700 active:bg-slate-50 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-300",children:"+1ì‹œê°„"})]})]})]}),e.jsx("hr",{className:"border-slate-100 dark:border-slate-700"}),e.jsxs("div",{className:"grid grid-cols-[80px_1fr] items-center gap-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400",children:"ë¹„ìš© (VND)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 pl-8 text-right text-sm font-medium tabular-nums text-slate-900 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100",type:"text",value:((T=i.cost)==null?void 0:T.toLocaleString())??"",onChange:o=>{const N=o.target.value.replace(/,/g,"");/^\d*$/.test(N)&&r("cost",N===""?0:Number(N))},placeholder:"0"}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-sm text-slate-400",children:"â‚«"})]})]}),e.jsxs("div",{className:"grid grid-cols-[80px_1fr] items-start gap-3",children:[e.jsx("label",{className:"mt-2 text-xs font-semibold text-slate-500 dark:text-slate-400",children:"ë©”ëª¨"}),e.jsx("textarea",{className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm leading-relaxed text-slate-900 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100",rows:4,value:i.note??"",onChange:o=>r("note",o.target.value),placeholder:"ë©”ë‰´ ì¶”ì²œ, ì˜ˆì•½ ë²ˆí˜¸ ë“±..."})]})]})})]})}function Ze(t,a={}){const{enableAutosave:s=!0,autosaveMs:l=1500}=a;de();const d=Q(),m=Y();S(h=>h.title??""),S(h=>h.currency??"VND"),S(h=>h._legacyBlocks??[]);const c=$(h=>h.currentDayId),{data:i,isLoading:n,refetch:v}=ge({queryKey:["plan",t],queryFn:()=>Promise.resolve(null),enabled:!1});w.useEffect(()=>{},[i]);const y=fe({mutationFn:async()=>{},onSuccess:()=>{window.dispatchEvent(new CustomEvent("toast",{detail:{type:"success",text:"ì €ì¥ë¨"}}))},onError:h=>{window.dispatchEvent(new CustomEvent("toast",{detail:{type:"error",text:`ì €ì¥ ì‹¤íŒ¨: ${(h==null?void 0:h.message)||"unknown"}`}}))}}),r=w.useCallback(()=>y.mutate(),[y]),x=w.useCallback(()=>v(),[v]);w.useRef(null),w.useEffect(()=>{},[s,l,t,r]);const p=w.useCallback(()=>{if(!c){window.dispatchEvent(new CustomEvent("toast",{detail:{type:"error",text:"ë¨¼ì € ì¼ì •ì„ ì„ íƒí•œ ë’¤ ì¥ì†Œë¥¼ ì¶”ê°€í•´ ì£¼ì„¸ìš”."}}));return}const h=new URLSearchParams;h.set("dayId",c),d({pathname:"/plan/search",search:h.toString()},{state:{backgroundLocation:m,background:m}})},[c,m,d]);return{plan:i,isLoading:n,save:r,saving:y.isPending,refresh:x,goAddPlaceForCurrentDay:p}}function Xe({onAddPlace:t}){const a=$(y=>y.currentDayId),s=$(y=>y.isPlanSheetOpen),l=$(y=>y.setPlanSheetOpen),d=S(y=>y.currentTripId),m=S(y=>y.deleteTrip),c=$(y=>y.reset),{goAddPlaceForCurrentDay:i}=Ze(void 0,{enableAutosave:!1}),n=t??i,v=()=>{d&&window.confirm("í˜„ì¬ ì—¬í–‰ ì¼ì •ì„ ëª¨ë‘ ì‚­ì œí•˜ê³  ë©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°ˆê¹Œìš”?")&&(m(d),c())};return e.jsxs("div",{className:"fixed bottom-4 right-4 z-[60] flex flex-col items-end gap-3 md:hidden",children:[d&&e.jsx("button",{type:"button",onClick:v,className:"inline-flex h-9 w-9 items-center justify-center rounded-full bg-red-500 text-white shadow-lg ring-1 ring-red-500/40","aria-label":"í˜„ì¬ ì—¬í–‰ ì‚­ì œ",children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>l(!s),className:"inline-flex h-11 w-11 items-center justify-center rounded-full bg-white shadow-lg ring-1 ring-black/5 dark:bg-gray-900","aria-label":s?"ì§€ë„ë¡œ ë³´ê¸°":"ì˜¤ëŠ˜ ì¼ì • ì‹œíŠ¸ ì—´ê¸°",children:s?e.jsx($e,{className:"h-5 w-5 text-gray-700 dark:text-gray-100"}):e.jsx(Me,{className:"h-5 w-5 text-gray-700 dark:text-gray-100"})}),e.jsx("button",{type:"button",className:"inline-flex h-11 w-11 items-center justify-center rounded-full bg-emerald-500 text-white shadow-lg ring-1 ring-emerald-500/40","aria-label":"ì¼ì • ì €ì¥",children:e.jsx(Oe,{className:"h-5 w-5"})}),e.jsxs("button",{type:"button",onClick:n,disabled:!a,className:"inline-flex items-center rounded-full bg-emerald-500 px-4 py-2 text-sm font-medium text-white shadow-lg ring-1 ring-emerald-500/40 disabled:cursor-not-allowed disabled:opacity-60",children:[e.jsx(Le,{className:"mr-1 h-4 w-4"}),"ì¥ì†Œ ì¶”ê°€"]})]})}function Je(t){const{locale:a,hasTrip:s,hasExistingTrip:l,currentTrip:d,currentDayId:m,daysOfCurrentTrip:c,isPlanSheetOpen:i,mobileSheetTitle:n,mobileFooter:v,onChangeDay:y,onTogglePlanSheet:r,onExportPdf:x,onCreateQuickTrip:p,onOpenSampleChooser:h,onImportSample:T,onOpenLastSavedTrip:o,onClosePlan:N}=t,k=e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-slate-900",children:e.jsx(Ue,{locale:a,hasExistingTrip:l,onCreateNew:p,onOpenSample:h,onImportSample:T,onOpenExisting:o})}),C=c.length>0?e.jsx("div",{className:"mt-2 flex flex-wrap gap-1.5 px-4 pb-2",children:c.map((f,u)=>{const g=f.id===m,j=a==="ko"?`${u+1}ì¼ì°¨`:`Day ${u+1}`;return e.jsx("button",{type:"button",onClick:()=>y(f.id),className:["rounded-full border px-3 py-1 text-xs font-medium transition",g?"border-emerald-500 bg-emerald-500 text-white":"border-slate-200 bg-white text-slate-600 hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-200"].join(" "),children:j},f.id)})}):null,b=e.jsxs("header",{className:"z-20 border-b border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900",children:[e.jsxs("div",{className:"flex h-14 items-center justify-between gap-4 px-4",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-3 overflow-hidden",children:[e.jsx("button",{type:"button",onClick:N,className:"flex shrink-0 items-center justify-center rounded-full p-2 text-slate-500 hover:bg-slate-100 hover:text-slate-900 dark:text-slate-400 dark:hover:bg-slate-800 dark:hover:text-slate-100",title:"ë©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"m12 19-7-7 7-7"}),e.jsx("path",{d:"M19 12H5"})]})}),e.jsx("div",{className:"h-4 w-px bg-slate-200 dark:bg-slate-700"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(ke,{})})]}),e.jsx("div",{className:"shrink-0",children:e.jsx("button",{type:"button",onClick:x,className:"rounded border border-slate-300 px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800",children:"PDF"})})]}),e.jsxs("div",{className:"pt-1",children:[e.jsx("div",{className:"px-4",children:e.jsx(Ke,{})}),C]})]});return e.jsxs("div",{className:"flex h-full w-full flex-col overflow-hidden bg-white dark:bg-slate-950",children:[e.jsx("div",{className:"hidden h-full flex-col md:flex",children:s?e.jsxs(e.Fragment,{children:[b,e.jsxs("div",{className:"flex flex-1 flex-row overflow-hidden",children:[e.jsx("aside",{className:"w-[380px] flex-shrink-0 flex-col border-r border-slate-200 bg-white dark:border-slate-800 dark:bg-slate-900",children:e.jsx("div",{className:"h-full w-full overflow-hidden",children:e.jsx(Z,{dayId:m})})}),e.jsxs("main",{className:"relative flex-1 bg-slate-100 dark:bg-slate-950",children:[e.jsx(J,{}),e.jsx(Qe,{})]})]})]}):k}),e.jsx("div",{className:"flex h-full flex-col md:hidden",children:s?e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx("div",{className:"flex-1",children:e.jsx(J,{})}),e.jsx(le,{open:i,onClose:()=>r(!1),title:n,initialSnap:"large",footer:v,children:e.jsx("div",{className:"h-full px-2",children:e.jsx(Z,{dayId:m})})}),e.jsx(Ge,{}),e.jsx(Xe,{})]}):k})]})}function P(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function et(t){const a=t.nights??2,s=a+1;if(!t.startDateISO)return`${a}ë°• ${s}ì¼`;const l=new Date(t.startDateISO),d=new Date(l.getTime());d.setDate(d.getDate()+a);const m=t.startDateISO,c=d.getFullYear(),i=`${d.getMonth()+1}`.padStart(2,"0"),n=`${d.getDate()}`.padStart(2,"0");return`${a}ë°• ${s}ì¼ Â· ${m} ~ ${c}-${i}-${n}`}function A(t,a){const s=a;try{return new Intl.NumberFormat(s==="KRW"?"ko-KR":s==="USD"?"en-US":"vi-VN",{style:"currency",currency:s,maximumFractionDigits:0}).format(t)}catch{return`${t.toLocaleString()} ${s}`}}function tt(t,a,s,l){if(!t){window.alert("ë¨¼ì € ì¼ì •ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.");return}const d=window.open("","_blank");if(!d){window.alert("íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.");return}const m=[...a].sort((T,o)=>T.order-o.order),c=new Map;for(const T of s)c.has(T.dayId)||c.set(T.dayId,[]),c.get(T.dayId).push(T);for(const[T,o]of c)o.sort((N,k)=>{const C=N.startTime||"",b=k.startTime||"";return C.localeCompare(b)});const i=t.budgetTotal??0,n=s.reduce((T,o)=>T+(o.cost??0),0),v=Math.max(0,i-n),y=t.travelerCount&&t.travelerCount>0?t.travelerCount:1,r=t.title||"ì œëª© ì—†ëŠ” ì—¬í–‰",x=et(t),p=t.currency||"VND",h=d.document;h.open(),h.write(`<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>${P(r)} - ì—¬í–‰ ì¼ì • PDF</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #111827;
      background-color: #f9fafb;
    }
    .page {
      width: 210mm;
      min-height: 297mm;
      padding: 16mm 18mm;
      margin: 0 auto;
      background: white;
    }
    h1, h2, h3 {
      margin: 0;
      font-weight: 600;
      color: #111827;
    }
    .trip-header {
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 12px;
      margin-bottom: 16px;
    }
    .trip-title {
      font-size: 20px;
      margin-bottom: 4px;
    }
    .trip-meta {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 6px;
    }
    .trip-budget {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 11px;
    }
    .chip {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
    }
    .chip-emerald {
      border-color: #a7f3d0;
      background: #ecfdf5;
      color: #047857;
    }
    .section {
      margin-top: 18px;
    }
    .section-title {
      font-size: 14px;
      margin-bottom: 8px;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 4px;
    }
    .day-block {
      margin-bottom: 12px;
    }
    .day-heading {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .day-date {
      font-size: 11px;
      color: #6b7280;
      margin-left: 4px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }
    th, td {
      padding: 4px 6px;
      border-bottom: 1px solid #e5e7eb;
      vertical-align: top;
    }
    th {
      text-align: left;
      background: #f9fafb;
      font-weight: 600;
    }
    .time-col {
      width: 70px;
      white-space: nowrap;
      font-feature-settings: "tnum";
    }
    .cost-col {
      width: 90px;
      text-align: right;
      font-feature-settings: "tnum";
    }
    .note {
      color: #6b7280;
      margin-top: 2px;
    }
    @media print {
      body {
        background: white;
      }
      .page {
        box-shadow: none;
        margin: 0;
        width: auto;
        min-height: auto;
        padding: 12mm 14mm;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="trip-header">
      <div class="trip-title">${P(r)}</div>
      <div class="trip-meta">
        ${P(x)} Â· ${y}ëª… Â· í†µí™”: ${P(p)}
      </div>
      <div class="trip-budget">
        <span class="chip">
          ì´ ì˜ˆì‚°: <strong>${P(A(i,p))}</strong>
        </span>
        <span class="chip">
          ì˜ˆìƒ ì§€ì¶œ: <strong>${P(A(n,p))}</strong>
        </span>
        <span class="chip chip-emerald">
          ë‚¨ì€ ì˜ˆì‚°: <strong>${P(A(v,p))}</strong>
        </span>
      </div>
    </header>

    <section class="section">
      <h2 class="section-title">ì¼ì • ìƒì„¸</h2>
`);for(const T of m){const o=c.get(T.id)??[],N=T.dateISO;let k=0;for(const C of o)k+=C.cost??0;h.write(`
      <div class="day-block">
        <div class="day-heading">
          Day ${T.order}
          <span class="day-date">${P(N)}</span>
          <span style="margin-left:8px; font-size:11px; color:#047857;">
            ì´ ë‚  ì˜ˆìƒ ë¹„ìš©: ${P(A(k,p))}
          </span>
        </div>
        <table>
          <thead>
            <tr>
              <th class="time-col">ì‹œê°„</th>
              <th>ì¼ì •</th>
              <th class="cost-col">ì˜ˆìƒ ë¹„ìš©</th>
            </tr>
          </thead>
          <tbody>
    `);for(const C of o){const b=C.startTime&&C.endTime?`${C.startTime} ~ ${C.endTime}`:C.startTime||C.endTime||"ì‹œê°„ ë¯¸ì •",f=C.cost!=null?A(C.cost,p):"";h.write(`
        <tr>
          <td class="time-col">${P(b)}</td>
          <td>
            <div>${P(C.title)}</div>
            ${C.note?`<div class="note">${P(C.note)}</div>`:""}
          </td>
          <td class="cost-col">
            ${f?P(f):""}
          </td>
        </tr>
      `)}o.length===0&&h.write(`
        <tr>
          <td class="time-col">-</td>
          <td colspan="2">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</td>
        </tr>
      `),h.write(`
          </tbody>
        </table>
      </div>
    `)}h.write(`
    </section>
  </div>
  <script>
    window.addEventListener("load", function () {
      setTimeout(function () { window.print(); }, 300);
    });
  <\/script>
</body>
</html>`),h.close()}const U="ko",F=(t,a,s)=>ne(t,a,s);function at(){const t=new Date,a=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return`${a}-${s}-${l}`}function rt(){const t=Q(),a=Y(),{hasTrip:s,currentTrip:l,currentDayId:d,daysOfCurrentTrip:m,setCurrentDayId:c}=he(),i=$(u=>u.isPlanSheetOpen),n=$(u=>u.setPlanSheetOpen),v=S(u=>u.importSampleTrip),y=$(u=>u.setLastSampleTripId),r=S(u=>Object.values(u.trips).some(g=>!g.isSample)),x=S(u=>{if(!u.currentTripId)return null;const g=u.trips[u.currentTripId];if(!g)return null;const j=g.dayIds.map(D=>u.days[D]).filter(D=>!!D),I=j.flatMap(D=>D.itemIds.map(E=>u.items[E]).filter(E=>!!E)),M=Object.values(u.links??{});return{trip:g,days:j,items:I,links:M}}),p=()=>{if(!x){O(F(U,"planPage","noTripToExport"));return}const u={...x.trip,budgetTotal:x.trip.budgetTotal??void 0};tt(u,x.days,x.items,x.links)},h=w.useMemo(()=>{if(!d||!m.length)return null;const u=m.findIndex(g=>g.id===d);return u===-1?null:u},[d,m]),T=w.useMemo(()=>!s||h==null?F(U,"planPage","mobileTodayTitle"):`${h+1}ì¼ì°¨ ì¼ì •`,[s,h]),o=()=>{const u=S.getState();if(typeof u.createTrip!="function")return;const g=u.createTrip({title:F(U,"planPage","quickTripTitle"),startDateISO:at(),nights:2,currency:"VND",budgetTotal:0,transportDefault:"car"});S.setState({currentTripId:g});const I=S.getState().trips[g];let M=null;I&&I.dayIds.length>0&&(M=I.dayIds[0]),M&&c(M),t("/plan")},N=()=>{t("/plan/sample",{state:{backgroundLocation:a,background:a}})},k=async u=>{try{const g=await v({templateId:u,isSample:!0});y(g);const I=S.getState().trips[g];I&&I.dayIds.length>0&&c(I.dayIds[0]),O.success("ì¶”ì²œ ì¼ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤."),t("/plan")}catch(g){console.error(g),O.error("ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},C=()=>{const u=S.getState(),g=Object.values(u.trips).filter(D=>!D.isSample);if(g.length===0){O(F(U,"planPage","noSavedTrip"));return}const I=[...g].sort((D,E)=>{const L=D.updatedAt||D.createdAt,V=E.updatedAt||E.createdAt;return!L&&!V?0:L?V?L===V?0:L<V?1:-1:-1:1})[0];S.setState({currentTripId:I.id});let M=null;I.dayIds&&I.dayIds.length>0&&(M=I.dayIds[0]),M&&c(M),t("/plan")},b=w.useCallback(()=>{S.setState({currentTripId:null}),c(null),t("/plan")},[c,t]);w.useEffect(()=>{if(!s)return;const u=j=>{if(j.key==="Backspace"){const I=j.target;I.tagName==="INPUT"||I.tagName==="TEXTAREA"||I.isContentEditable||(j.preventDefault(),b())}},g=j=>{j.button===3&&(j.preventDefault(),b())};return window.addEventListener("keydown",u),window.addEventListener("mouseup",g),()=>{window.removeEventListener("keydown",u),window.removeEventListener("mouseup",g)}},[s,b]);const f=w.useMemo(()=>s?e.jsx("div",{className:"flex justify-end border-t bg-white px-3 py-2 text-xs dark:border-slate-700 dark:bg-slate-900",children:e.jsx("button",{type:"button",onClick:()=>{if(!d){O("ë¨¼ì € ì¼ì •ì„ ì„ íƒí•œ ë’¤ ì¥ì†Œë¥¼ ì¶”ê°€í•´ ì£¼ì„¸ìš”.");return}const u=`/plan/search?dayId=${encodeURIComponent(String(d))}`;t(u,{state:{backgroundLocation:a,background:a}})},className:"rounded-md bg-emerald-500 px-3 py-1.5 text-xs font-medium text-white shadow hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1",children:F(U,"planPage","mobileAddPlaceButton")})}):null,[s,d,t,a]);return e.jsx(Je,{locale:U,hasTrip:s,hasExistingTrip:r,currentTrip:l,currentDayId:d,daysOfCurrentTrip:m,isPlanSheetOpen:i,mobileSheetTitle:T,mobileFooter:f,onChangeDay:c,onTogglePlanSheet:n,onExportPdf:p,onCreateQuickTrip:o,onOpenSampleChooser:N,onImportSample:k,onOpenLastSavedTrip:C,onClosePlan:b})}function xt(){return e.jsxs("div",{className:"flex h-[calc(100vh-64px)] w-full flex-col overflow-hidden bg-white dark:bg-slate-950",children:[e.jsx(rt,{}),e.jsx(ce,{})]})}export{xt as PlanPage,xt as default};
